(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{460:function(t,s,a){"use strict";a.r(s);var e=a(53),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"nodejs之module模块学习笔记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nodejs之module模块学习笔记"}},[t._v("#")]),t._v(" NodeJS之module模块学习笔记")]),t._v(" "),a("p",[a("img",{attrs:{src:"E:%5Cblog%5Cimages%5Cnode%5Cnode-module.png",alt:"module"}})]),t._v(" "),a("h2",{attrs:{id:"_1-module模块简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-module模块简介"}},[t._v("#")]),t._v(" 1.module模块简介")]),t._v(" "),a("p",[t._v("在NodeJS中，每个文件都被视为一个独立的模块。NodeJS默认支持"),a("code",[t._v("common.js")]),t._v("规范。")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://juejin.im/post/5dfef166518825126131ce0f#heading-0",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaScript模块化规范（CommonJs AMD CMD UMD ES6）"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.im/entry/5ac83dff5188255c4c1084fd",target:"_blank",rel:"noopener noreferrer"}},[t._v("结合源码分析 Node.js 模块加载与运行原理"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"_2-访问主模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-访问主模块"}},[t._v("#")]),t._v(" 2.访问主模块")]),t._v(" "),a("p",[t._v("当 Node.js 直接运行一个文件时， "),a("code",[t._v("require.main")]),t._v(" 会被设为它的 "),a("code",[t._v("module")]),t._v("。 这意味着可以通过 "),a("code",[t._v("require.main === module")]),t._v(" 来判断一个文件是否被直接运行：")]),t._v(" "),a("p",[t._v("对于 "),a("code",[t._v("foo.js")]),t._v(" 文件，如果通过 "),a("code",[t._v("node foo.js")]),t._v(" 运行则为 "),a("code",[t._v("true")]),t._v("，但如果通过 "),a("code",[t._v("require('./foo')")]),t._v(" 运行则为 "),a("code",[t._v("false")]),t._v("。")]),t._v(" "),a("p",[t._v("因为 "),a("code",[t._v("module")]),t._v(" 提供了一个 "),a("code",[t._v("filename")]),t._v(" 属性（通常等同于 "),a("code",[t._v("__filename")]),t._v("），所以可以通过检查 "),a("code",[t._v("require.main.filename")]),t._v(" 来获取当前应用程序的入口点。")]),t._v(" "),a("h2",{attrs:{id:"_3-缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-缓存"}},[t._v("#")]),t._v(" 3.缓存")]),t._v(" "),a("p",[t._v("模块是基于其解析的文件名进行缓存的。 由于调用模块的位置的不同，模块可能被解析成不同的文件名（比如从 "),a("code",[t._v("node_modules")]),t._v(" 目录加载），这样就不能保证 "),a("code",[t._v("require('foo')")]),t._v(" 总能返回完全相同的对象。")]),t._v(" "),a("p",[t._v("此外，在不区分大小写的文件系统或操作系统中，被解析成不同的文件名可以指向同一文件，但缓存仍然会将它们视为不同的模块，并多次重新加载。 例如， "),a("code",[t._v("require('./foo')")]),t._v(" 和 "),a("code",[t._v("require('./FOO')")]),t._v(" 返回两个不同的对象，而不会管 "),a("code",[t._v("./foo")]),t._v(" 和 "),a("code",[t._v("./FOO")]),t._v(" 是否是相同的文件。")]),t._v(" "),a("h2",{attrs:{id:"_4-核心模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-核心模块"}},[t._v("#")]),t._v(" 4.核心模块")]),t._v(" "),a("p",[a("code",[t._v("require()")]),t._v(" 总是会优先加载核心模块(核心模块定义在 Node.js 源代码的 "),a("code",[t._v("lib/")]),t._v(" 目录下)。 例如， "),a("code",[t._v("require('http')")]),t._v(" 始终返回内置的 HTTP 模块，即使有同名文件。")]),t._v(" "),a("h2",{attrs:{id:"_5-循环加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-循环加载"}},[t._v("#")]),t._v(" 5.循环加载")]),t._v(" "),a("p",[t._v("当循环调用 "),a("code",[t._v("require()")]),t._v(" 时，一个模块可能在未完成执行时被返回。")]),t._v(" "),a("p",[t._v("例如以下情况:")]),t._v(" "),a("p",[a("code",[t._v("a.js")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a 开始'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'在 a 中，b.done = %j'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'a 结束'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("b.js")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b 开始'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'在 b 中，a.done = %j'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nexports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'b 结束'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[a("code",[t._v("main.js")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'main 开始'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./a.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./b.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'在 main 中，a.done=%j，b.done=%j'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("当 "),a("code",[t._v("main.js")]),t._v(" 加载 "),a("code",[t._v("a.js")]),t._v(" 时， "),a("code",[t._v("a.js")]),t._v(" 又加载 "),a("code",[t._v("b.js")]),t._v("。 此时， "),a("code",[t._v("b.js")]),t._v(" 会尝试去加载 "),a("code",[t._v("a.js")]),t._v("。 为了防止无限的循环，会返回一个 "),a("code",[t._v("a.js")]),t._v(" 的 "),a("code",[t._v("exports")]),t._v(" 对象的 "),a("strong",[t._v("未完成的副本")]),t._v(" 给 "),a("code",[t._v("b.js")]),t._v(" 模块。 然后 "),a("code",[t._v("b.js")]),t._v(" 完成加载，并将 "),a("code",[t._v("exports")]),t._v(" 对象提供给 "),a("code",[t._v("a.js")]),t._v(" 模块。")]),t._v(" "),a("p",[t._v("当 "),a("code",[t._v("main.js")]),t._v(" 加载这两个模块时，它们都已经完成加载。 因此，该程序的输出会是：")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ node main.js\nmain 开始\na 开始\nb 开始\n在 b 中，a.done = false\nb 结束\n在 a 中，b.done = true\na 结束\n在 main 中，a.done=true，b.done=true\n")])])]),a("p",[t._v("需要仔细的规划, 以允许循环模块依赖在应用程序内正常工作.")]),t._v(" "),a("h2",{attrs:{id:"_6-文件模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-文件模块"}},[t._v("#")]),t._v(" 6.文件模块")]),t._v(" "),a("p",[t._v("如果按确切的文件名没有找到模块，则 Node.js 会尝试带上 "),a("code",[t._v(".js")]),t._v("、 "),a("code",[t._v(".json")]),t._v(" 或 "),a("code",[t._v(".node")]),t._v(" 拓展名再加载。")]),t._v(" "),a("p",[a("code",[t._v(".js")]),t._v(" 文件会被解析为 JavaScript 文本文件， "),a("code",[t._v(".json")]),t._v(" 文件会被解析为 JSON 文本文件。 "),a("code",[t._v(".node")]),t._v(" 文件会被解析为通过 "),a("code",[t._v("process.dlopen()")]),t._v(" 加载的编译后的插件模块。")]),t._v(" "),a("p",[t._v("以 "),a("code",[t._v("'/'")]),t._v(" 为前缀的模块是文件的绝对路径。 例如， "),a("code",[t._v("require('/home/marco/foo.js')")]),t._v(" 会加载 "),a("code",[t._v("/home/marco/foo.js")]),t._v(" 文件。")]),t._v(" "),a("p",[t._v("以 "),a("code",[t._v("'./'")]),t._v(" 为前缀的模块是相对于调用 "),a("code",[t._v("require()")]),t._v(" 的文件的。 也就是说， "),a("code",[t._v("circle.js")]),t._v(" 必须和 "),a("code",[t._v("foo.js")]),t._v(" 在同一目录下以便于 "),a("code",[t._v("require('./circle')")]),t._v(" 找到它。")]),t._v(" "),a("p",[t._v("当没有以 "),a("code",[t._v("'/'")]),t._v("、 "),a("code",[t._v("'./'")]),t._v(" 或 "),a("code",[t._v("'../'")]),t._v(" 开头来表示文件时，这个模块必须是一个核心模块或加载自 "),a("code",[t._v("node_modules")]),t._v(" 目录。")]),t._v(" "),a("p",[t._v("如果给定的路径不存在，则 "),a("code",[t._v("require()")]),t._v(" 会抛出一个 "),a("code",[t._v("code")]),t._v(" 属性为 "),a("code",[t._v("'MODULE_NOT_FOUND'")]),t._v(" 的 "),a("a",{attrs:{href:"http://nodejs.cn/s/FLTm19",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("Error")]),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_7-从-node-modules-目录加载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-从-node-modules-目录加载"}},[t._v("#")]),t._v(" 7.从 node_modules 目录加载")]),t._v(" "),a("p",[t._v("如果传递给 "),a("code",[t._v("require()")]),t._v(" 的模块标识符不是一个"),a("a",{attrs:{href:"http://nodejs.cn/api/modules.html#modules_core_modules",target:"_blank",rel:"noopener noreferrer"}},[t._v("核心模块"),a("OutboundLink")],1),t._v("，也没有以 "),a("code",[t._v("'/'")]),t._v(" 、 "),a("code",[t._v("'../'")]),t._v(" 或 "),a("code",[t._v("'./'")]),t._v(" 开头，则 Node.js 会从当前模块的父目录开始，尝试从它的 "),a("code",[t._v("/node_modules")]),t._v(" 目录里加载模块。 Node.js 不会附加 "),a("code",[t._v("node_modules")]),t._v(" 到一个已经以 "),a("code",[t._v("node_modules")]),t._v(" 结尾的路径上。")]),t._v(" "),a("p",[t._v("如果还是没有找到，则移动到再上一层父目录，直到文件系统的根目录。")]),t._v(" "),a("p",[t._v("例子，如果在 "),a("code",[t._v("'/home/ry/projects/foo.js'")]),t._v(" 文件里调用了 "),a("code",[t._v("require('bar.js')")]),t._v("，则 Node.js 会按以下顺序查找：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("/home/ry/projects/node_modules/bar.js")])]),t._v(" "),a("li",[a("code",[t._v("/home/ry/node_modules/bar.js")])]),t._v(" "),a("li",[a("code",[t._v("/home/node_modules/bar.js")])]),t._v(" "),a("li",[a("code",[t._v("/node_modules/bar.js")])])]),t._v(" "),a("p",[t._v("这使得程序本地化它们的依赖，避免它们产生冲突。")]),t._v(" "),a("p",[t._v("通过在模块名后包含一个路径后缀，可以请求特定的文件或分布式的子模块。 例如， "),a("code",[t._v("require('example-module/path/to/file')")]),t._v(" 会把 "),a("code",[t._v("path/to/file")]),t._v(" 解析成相对于 "),a("code",[t._v("example-module")]),t._v(" 的位置。 后缀路径同样遵循模块的解析语法。")]),t._v(" "),a("h2",{attrs:{id:"_8-模块封装器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-模块封装器"}},[t._v("#")]),t._v(" 8.模块封装器")]),t._v(" "),a("p",[t._v("在执行模块代码之前，Node.js 会使用一个如下的匿名函数封装器将其封装：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" require"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模块的代码实际上在这里")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("通过这样做，Node.js 实现了以下几点：")]),t._v(" "),a("ul",[a("li",[t._v("它保持了顶层的变量（用 "),a("code",[t._v("var")]),t._v("、 "),a("code",[t._v("const")]),t._v(" 或 "),a("code",[t._v("let")]),t._v(" 定义）作用在模块范围内，而不是全局对象。")]),t._v(" "),a("li",[t._v("它有助于提供一些看似全局的但实际上是模块特定的变量，例如：\n"),a("ul",[a("li",[t._v("实现者可以用于从模块中导出值的 "),a("code",[t._v("module")]),t._v(" 和 "),a("code",[t._v("exports")]),t._v(" 对象。")]),t._v(" "),a("li",[t._v("包含模块绝对文件名和目录路径的快捷变量 "),a("code",[t._v("__filename")]),t._v(" 和 "),a("code",[t._v("__dirname")]),t._v(" 。")])])])]),t._v(" "),a("h2",{attrs:{id:"_9-模块作用域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-模块作用域"}},[t._v("#")]),t._v(" 9.模块作用域")]),t._v(" "),a("h3",{attrs:{id:"_9-1-dirname和-filename当前模块的目录名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-dirname和-filename当前模块的目录名"}},[t._v("#")]),t._v(" 9.1 "),a("code",[t._v("__dirname")]),t._v("和"),a("code",[t._v("__filename")]),t._v("当前模块的目录名")]),t._v(" "),a("p",[t._v("与 "),a("a",{attrs:{href:"http://nodejs.cn/s/RH6qCV",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("__filename")]),a("OutboundLink")],1),t._v(" 的 "),a("a",{attrs:{href:"http://nodejs.cn/s/7t4KCq",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("path.dirname()")]),a("OutboundLink")],1),t._v(" 相同。")]),t._v(" "),a("p",[t._v("示例，从 "),a("code",[t._v("/Users/mjr")]),t._v(" 运行 "),a("code",[t._v("node example.js")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打印: /Users/mjr")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("dirname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__filename"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打印: /Users/mjr")]),t._v("\n")])])]),a("h3",{attrs:{id:"_9-2-exports-快捷方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-exports-快捷方式"}},[t._v("#")]),t._v(" 9.2 exports 快捷方式")]),t._v(" "),a("p",[a("code",[t._v("exports")]),t._v(" 变量是在模块的文件级作用域内可用的，且在"),a("strong",[t._v("模块执行之前")]),t._v("赋值给 "),a("code",[t._v("module.exports")]),t._v("。")]),t._v(" "),a("p",[t._v("它允许使用快捷方式，因此 "),a("code",[t._v("module.exports.f = ...")]),t._v(" 可以更简洁地写成 "),a("code",[t._v("exports.f = ...")]),t._v("。 但是，就像任何变量一样，如果为 "),a("code",[t._v("exports")]),t._v(" 赋予了新值，则它将不再绑定到 "),a("code",[t._v("module.exports")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hello "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从模块的引用中导出。")]),t._v("\nexports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" hello"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不导出，仅在模块中可用。")]),t._v("\n")])])]),a("p",[t._v("当 "),a("code",[t._v("module.exports")]),t._v(" 属性被新对象完全替换时，通常也会重新赋值 "),a("code",[t._v("exports")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("为了说明这种行为，想象对 "),a("code",[t._v("require()")]),t._v(" 的假设实现，它与 "),a("code",[t._v("require()")]),t._v(" 的实际实现非常类似：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ... */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" module "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" exports"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模块代码在这。在这个例子中，定义了一个函数。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("someFunc")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" someFunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时，exports 不再是一个 module.exports 的快捷方式，")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 且这个模块依然导出一个空的默认对象。")]),t._v("\n    module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" someFunc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时，该模块导出 someFunc，而不是默认对象。")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_9-3-module对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-module对象"}},[t._v("#")]),t._v(" 9.3 "),a("code",[t._v("module")]),t._v("对象")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("module.children")]),t._v("：<module[]>  被该模块引用的模块对象。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.exports")]),t._v(": "),a("object",[a("code",[t._v("module.exports")]),t._v(" 对象由 "),a("code",[t._v("Module")]),t._v(" 系统创建。")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.filename")]),t._v(": "),a("string",[t._v("模块的完全解析后的文件名。")])],1)]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.id")]),t._v(": "),a("string",[t._v("模块的标识符。 通常是完全解析后的文件名。")])],1)]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.loaded")]),t._v("："),a("boolean",[t._v("模块是否已经加载完成，或正在加载中。")])],1)]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.parent")]),t._v(": "),a("moduls",[t._v("最先引用该模块的模块。")])],1)]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.paths")]),t._v(": <string[]>模块的搜索路径。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.require(id)")]),t._v(": id"),a("string",[t._v(", 返回: "),a("a",{attrs:{href:"http://nodejs.cn/s/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[a("any",[a("OutboundLink")],1)],1),t._v(" 导出的模块内容。")])],1)]),t._v(" "),a("li",[a("p",[a("code",[t._v("module.require()")]),t._v(" 方法提供了一种加载模块的方法，就像从原始模块调用 "),a("code",[t._v("require()")]),t._v(" 一样。")]),t._v(" "),a("p",[t._v("为了做到这个，需要获得一个 "),a("code",[t._v("module")]),t._v(" 对象的引用。 因为 "),a("code",[t._v("require()")]),t._v(" 会返回 "),a("code",[t._v("module.exports")]),t._v("，且 "),a("code",[t._v("module")]),t._v(" 通常只在一个特定的模块代码中有效，所以为了使用它，必须显式地导出。")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);