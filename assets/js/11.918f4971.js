(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{455:function(t,s,n){"use strict";n.r(s);var a=n(53),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"nodejs之http模块学习笔记"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs之http模块学习笔记"}},[t._v("#")]),t._v(" NodeJS之HTTP模块学习笔记")]),t._v(" "),n("p",[n("img",{attrs:{src:"E:%5Cblog%5Cimages%5Cnode%5Chttp-module.png",alt:"HTTP模块"}})]),t._v(" "),n("h2",{attrs:{id:"_1-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[t._v("#")]),t._v(" 1.简介")]),t._v(" "),n("p",[t._v("NodeJS 中的 HTTP 接口旨在支持传统上难以使用的协议的许多特性。 特别是，大块的、可能块编码的消息。 接口永远不会缓冲整个请求或响应，所以用户能够"),n("strong",[t._v("流式传输")]),t._v("数据。--- 摘自官网"),n("a",{attrs:{href:"http://nodejs.cn/api/http.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http（HTTP）"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"_1-使用方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用方式"}},[t._v("#")]),t._v(" 1.使用方式")]),t._v(" "),n("p",[t._v("要使用 HTTP 服务器和客户端，必须 "),n("code",[t._v("require('http')")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不需要实例化,直接使用")]),t._v("\nhttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"_2-从module-exports说起"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-从module-exports说起"}},[t._v("#")]),t._v(" 2.从module.exports说起")]),t._v(" "),n("p",[t._v("查看http模块源码：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("METHODS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// HTTP方法")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STATUS_CODES")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 标准 HTTP 响应状态码")]),t._v("\n  Agent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" httpAgent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Agent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 管理 HTTP 客户端的连接持久性和重用")]),t._v("\n  ClientRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求类")]),t._v("\n  IncomingMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 访问响应状态、消息头、以及数据")]),t._v("\n  OutgoingMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  Server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务")]),t._v("\n  ServerResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 响应类")]),t._v("\n  createServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建服务 new Server")]),t._v("\n  get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建get请求api")]),t._v("\n  request "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建各种http请求api")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("这里可以看出，http模块默认将各种方法导出，它没有定义一个统一的构造方法，可以直接通过"),n("code",[t._v("http.createServer")]),t._v("这种方式调用。")]),t._v(" "),n("h2",{attrs:{id:"_3-http-methods"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-http-methods"}},[t._v("#")]),t._v(" 3.http.METHODS")]),t._v(" "),n("p",[t._v("返回类型："),n("code",[t._v("<string[]>")])]),t._v(" "),n("p",[t._v("解析器支持的 HTTP 方法列表，依赖于"),n("code",[t._v("_http_common")]),t._v("模块。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" methods "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_http_common'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("METHODS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" methods"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("slice")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("这里"),n("code",[t._v("http.METHODS")]),t._v("对"),n("code",[t._v("_http_common")]),t._v("模块中的"),n("code",[t._v("methods")]),t._v("做了一个浅拷贝并排序。")]),t._v(" "),n("h2",{attrs:{id:"_4-http-status-codes"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-http-status-codes"}},[t._v("#")]),t._v(" 4.http.STATUS_CODES")]),t._v(" "),n("p",[t._v("返回类型："),n("code",[t._v("<Object>")])]),t._v(" "),n("p",[t._v("所有标准 HTTP 响应状态码的集合，以及每个状态码的简短描述。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STATUS_CODES")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Continue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Switching Protocols'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("102")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Processing'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 2518, obsoleted by RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("103")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Early Hints'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'OK'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("201")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Created'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("202")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Accepted'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("203")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Non-Authoritative Information'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'No Content'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("205")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Reset Content'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("206")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Partial Content'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("207")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Multi-Status'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("208")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Already Reported'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("226")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'IM Used'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Multiple Choices'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 7231")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Moved Permanently'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("302")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Found'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("303")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'See Other'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("304")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not Modified'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("305")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Use Proxy'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("307")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Temporary Redirect'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("308")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Permanent Redirect'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 7238")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bad Request'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("401")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Unauthorized'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("402")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Payment Required'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Forbidden'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not Found'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("405")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Method Not Allowed'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("406")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not Acceptable'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("407")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Proxy Authentication Required'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("408")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Request Timeout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("409")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Conflict'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("410")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Gone'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("411")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Length Required'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("412")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Precondition Failed'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("413")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Payload Too Large'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("414")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'URI Too Long'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("415")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Unsupported Media Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Range Not Satisfiable'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("417")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Expectation Failed'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("418")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'I\\'m a Teapot'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("              "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 7168")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("421")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Misdirected Request'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("422")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Unprocessable Entity'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("423")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Locked'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("424")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Failed Dependency'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("425")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Unordered Collection'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("426")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upgrade Required'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("           "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 2817")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("428")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Precondition Required'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 6585")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("429")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Too Many Requests'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 6585")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("431")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Request Header Fields Too Large'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 6585")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("451")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Unavailable For Legal Reasons'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Internal Server Error'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("501")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not Implemented'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bad Gateway'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Service Unavailable'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Gateway Timeout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("505")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP Version Not Supported'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("506")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Variant Also Negotiates'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 2295")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("507")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Insufficient Storage'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 4918")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("508")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Loop Detected'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("509")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bandwidth Limit Exceeded'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("510")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not Extended'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 2774")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("511")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Network Authentication Required'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// RFC 6585")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"_5-http-createserver方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-http-createserver方法"}},[t._v("#")]),t._v(" 5.http.createServer方法")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("options")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" "),n("ul",[n("li",[n("code",[t._v("IncomingMessage")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2RqpEw",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.IncomingMessage>"),n("OutboundLink")],1),t._v(" 指定要使用的 "),n("code",[t._v("IncomingMessage")]),t._v(" 类。用于扩展原始的 "),n("code",[t._v("IncomingMessage")]),t._v("。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("IncomingMessage")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("ServerResponse")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/rMXoZ1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.ServerResponse>"),n("OutboundLink")],1),t._v(" 指定要使用的 "),n("code",[t._v("ServerResponse")]),t._v(" 类。用于扩展原始的 "),n("code",[t._v("ServerResponse")]),t._v("。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("ServerResponse")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("insecureHTTPParser")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),t._v(" 使用不安全的 HTTP 解析器，当为 "),n("code",[t._v("true")]),t._v(" 时接受无效的 HTTP 请求头。应避免使用不安全的解析器。有关更多信息，参见 "),n("a",{attrs:{href:"http://nodejs.cn/s/5Bnm43",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("--insecure-http-parser")]),n("OutboundLink")],1),t._v("。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("false")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("maxHeaderSize")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 可选地，重写此服务器接收的请求的 "),n("a",{attrs:{href:"http://nodejs.cn/s/HfsyuU",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("--max-http-header-size")]),n("OutboundLink")],1),t._v(" 值，即请求头的最大长度（以字节为单位）。 "),n("strong",[t._v("默认值:")]),t._v(" 16384（16KB）。")])])]),t._v(" "),n("li",[n("code",[t._v("requestListener")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),t._v("， 是一个自动添加到 "),n("a",{attrs:{href:"http://nodejs.cn/s/2qCn57",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'request'")]),n("OutboundLink")],1),t._v(" 事件的函数。参数(request, response)见后面的"),n("code",[t._v("http.clientRequest")]),t._v("和"),n("code",[t._v("http.ServerResponse")]),t._v("。")]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/jLiRTh",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.Server>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("源码解读：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  Server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n \t"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_http_server'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("opts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" requestListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("opts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" requestListener"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("Server")]),t._v("通过"),n("code",[t._v("http.createServer")]),t._v("来实例化，也就是说，我们也可以通过以下方式创建服务器：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实例化")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h2",{attrs:{id:"_6-http-agent类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-http-agent类"}},[t._v("#")]),t._v(" 6.http.Agent类")]),t._v(" "),n("p",[t._v("简介："),n("code",[t._v("Agent")]),t._v(" 负责管理 HTTP 客户端的连接持久性和重用。当不再使用时最好 "),n("a",{attrs:{href:"http://nodejs.cn/s/qZQu4q",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("destroy()")]),n("OutboundLink")],1),t._v(" "),n("code",[t._v("Agent")]),t._v(" 实例，因为未使用的"),n("code",[t._v("Socket")]),t._v("会消耗操作系统资源。参见官网"),n("a",{attrs:{href:"http://nodejs.cn/api/http.html#http_class_http_agent",target:"_blank",rel:"noopener noreferrer"}},[t._v("http.Agent 类"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"_6-1new-agent-options-构造方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-1new-agent-options-构造方法"}},[t._v("#")]),t._v(" 6.1"),n("code",[t._v("new Agent([options])")]),t._v("构造方法")]),t._v(" "),n("p",[n("code",[t._v("options")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" 要在代理上设置的可配置选项集：")]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("keepAlive <boolean>")]),t._v("，"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("false")]),t._v(", true-开启长连接；")]),t._v(" "),n("p",[t._v("不要与 "),n("code",[t._v("Connection")]),t._v(" 请求头的 "),n("code",[t._v("keep-alive")]),t._v(" 值混淆。 "),n("code",[t._v("Connection: keep-alive")]),t._v(" 请求头始终在使用代理时发送，除非明确指定 "),n("code",[t._v("Connection")]),t._v(" 请求头、或者 "),n("code",[t._v("keepAlive")]),t._v(" 和 "),n("code",[t._v("maxSockets")]),t._v(" 选项分别设置为 "),n("code",[t._v("false")]),t._v(" 和 "),n("code",[t._v("Infinity")]),t._v("，在这种情况下将会使用 "),n("code",[t._v("Connection: close")]),t._v("。")])])]),t._v(" "),n("blockquote",[n("p",[n("a",{attrs:{href:"https://my.oschina.net/antianlu/blog/261105",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodeJS如何实现真正的长连接？"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.yuque.com/egg/nodejs/keep-alive-agent-econnreset",target:"_blank",rel:"noopener noreferrer"}},[t._v("解决使用 KeepAlive Agent 遇到的 ECONNRESET"),n("OutboundLink")],1)])]),t._v(" "),n("ul",[n("li",[n("p",[n("code",[t._v("keepAliveMsecs")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 当使用 "),n("code",[t._v("keepAlive")]),t._v(" 选项时，指定用于 TCP Keep-Alive 数据包的"),n("a",{attrs:{href:"http://nodejs.cn/s/qqbgUD",target:"_blank",rel:"noopener noreferrer"}},[t._v("初始延迟"),n("OutboundLink")],1),t._v("。当 "),n("code",[t._v("keepAlive")]),t._v(" 选项为 "),n("code",[t._v("false")]),t._v(" 或 "),n("code",[t._v("undefined")]),t._v(" 时则忽略。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("1000")]),t._v("。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("maxSockets")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 每个主机允许的"),n("code",[t._v("Socket")]),t._v("的最大数量。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("Infinity")]),t._v("。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("maxFreeSockets")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[t._v("number"),n("OutboundLink")],1),t._v(" 在空闲状态下保持打开的"),n("code",[t._v("Socket")]),t._v("的最大数量。仅当 "),n("code",[t._v("keepAlive")]),t._v(" 被设置为 "),n("code",[t._v("true")]),t._v(" 时才相关。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("256")]),t._v("。")])]),t._v(" "),n("li",[n("p",[n("code",[t._v("timeout")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" "),n("code",[t._v("Socket")]),t._v("的超时时间，以毫秒为单位。这会在"),n("code",[t._v("Socket")]),t._v("被连接之后设置超时时间。")])])]),t._v(" "),n("p",[t._v("要配置其中任何一个，则必须创建自定义的 "),n("a",{attrs:{href:"http://nodejs.cn/s/HRCnER",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.Agent")]),n("OutboundLink")],1),t._v(" 实例:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" keepAliveAgent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Agent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" keepAlive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\noptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("agent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" keepAliveAgent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nhttp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onResponseCallback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_6-2-agent-createconnection-options-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-agent-createconnection-options-callback"}},[t._v("#")]),t._v(" 6.2 "),n("code",[t._v("agent.createConnection(options[, callback])")])]),t._v(" "),n("p",[t._v("生成用于 HTTP 请求的"),n("code",[t._v("Socket")]),t._v("或流。默认情况下，此函数与 "),n("a",{attrs:{href:"http://nodejs.cn/s/xu7F69",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("net.createConnection()")]),n("OutboundLink")],1),t._v(" 相同。")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("options")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" 包含连接详细信息的选项。 查看 "),n("a",{attrs:{href:"http://nodejs.cn/s/xu7F69",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("net.createConnection()")]),n("OutboundLink")],1),t._v(" 以获取选项的格式。")]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),t._v(" 接收创建的"),n("code",[t._v("Socket")]),t._v("的回调函数。")]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)])]),t._v(" "),n("h3",{attrs:{id:"_6-3-agent-keepsocketalive-socket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-agent-keepsocketalive-socket"}},[t._v("#")]),t._v(" 6.3 "),n("code",[t._v("agent.keepSocketAlive(socket)")])]),t._v(" "),n("p",[n("code",[t._v("socket")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("当 "),n("code",[t._v("socket")]),t._v(" 与请求分离并且可以由 "),n("code",[t._v("Agent")]),t._v(" 保留时调用。 默认行为是：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setKeepAlive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keepAliveMsecs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unref")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("此方法可以由特定的 "),n("code",[t._v("Agent")]),t._v(" 子类重写。")]),t._v(" "),n("h3",{attrs:{id:"_6-4-agent-reusesocket-socket-request"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-4-agent-reusesocket-socket-request"}},[t._v("#")]),t._v(" 6.4 "),n("code",[t._v("agent.reuseSocket(socket, request)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("socket")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("code",[t._v("request")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2F5RHd",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.ClientRequest>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("由于 keep-alive 选项而在持久化后将 "),n("code",[t._v("socket")]),t._v(" 附加到 "),n("code",[t._v("request")]),t._v(" 时调用。 默认行为是：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("此方法可以由特定的 "),n("code",[t._v("Agent")]),t._v(" 子类重写。")]),t._v(" "),n("h3",{attrs:{id:"_6-5-agent-destroy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-5-agent-destroy"}},[t._v("#")]),t._v(" 6.5 "),n("code",[t._v("agent.destroy()")])]),t._v(" "),n("p",[t._v("销毁代理当前使用的所有"),n("code",[t._v("Socket")]),t._v("。")]),t._v(" "),n("p",[t._v("通常没有必要这样做。 但是，如果使用启用了 "),n("code",[t._v("keepAlive")]),t._v(" 的代理，则最好在代理不再使用时显式关闭代理。 否则，在服务器终止"),n("code",[t._v("Socket")]),t._v("之前，"),n("code",[t._v("Socket")]),t._v("可能会挂起很长时间。")]),t._v(" "),n("h3",{attrs:{id:"_6-6-agent-freesockets"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-6-agent-freesockets"}},[t._v("#")]),t._v(" 6.6 "),n("code",[t._v("agent.freeSockets")])]),t._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),t._v(" "),n("p",[t._v("一个对象，其中包含当启用 "),n("code",[t._v("keepAlive")]),t._v(" 时代理正在等待使用的"),n("code",[t._v("Socket")]),t._v("数组。 不要修改。")]),t._v(" "),n("p",[n("code",[t._v("freeSockets")]),t._v(" 列表中的 socket 会在 `'timeout' 时自动被销毁并从数组中删除。")]),t._v(" "),n("h3",{attrs:{id:"_6-7-agent-getname-options"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-7-agent-getname-options"}},[t._v("#")]),t._v(" 6.7  "),n("code",[t._v("agent.getName(options)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("options")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" 一组选项，为生成名称提供信息。\n"),n("ul",[n("li",[n("code",[t._v("host")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 请求发送至的服务器的域名或 IP 地址。")]),t._v(" "),n("li",[n("code",[t._v("port")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 远程服务器的端口。")]),t._v(" "),n("li",[n("code",[t._v("localAddress")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 为网络连接绑定的本地接口。")]),t._v(" "),n("li",[n("code",[t._v("family")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1),t._v(" 如果不等于 "),n("code",[t._v("undefined")]),t._v("，则必须为 4 或 6。")])])]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("获取一组请求选项的唯一名称，以判定一个连接是否可以被重用。 对于 HTTP 代理，这返回 "),n("code",[t._v("host:port:localAddress")]),t._v(" 或 "),n("code",[t._v("host:port:localAddress:family")]),t._v("。 对于 HTTPS 代理，该名称包括 CA、证书、密码、以及其他可判定"),n("code",[t._v("Socket")]),t._v("可重用性的 HTTPS/TLS 特有的选项。")]),t._v(" "),n("h3",{attrs:{id:"_6-8-agent-maxfreesockets"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-8-agent-maxfreesockets"}},[t._v("#")]),t._v(" 6.8 "),n("code",[t._v("agent.maxFreeSockets")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("默认设置为 256。 对于启用了 "),n("code",[t._v("keepAlive")]),t._v(" 的代理，这将设置在空闲状态下保持打开的最大"),n("code",[t._v("Socket")]),t._v("数。")]),t._v(" "),n("h3",{attrs:{id:"_6-9-agent-requests"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-9-agent-requests"}},[t._v("#")]),t._v(" 6.9 "),n("code",[t._v("agent.requests")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("一个对象，包含尚未分配给"),n("code",[t._v("Socket")]),t._v("的请求队列。 不要修改。")]),t._v(" "),n("h3",{attrs:{id:"_6-10-agent-sockets"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-10-agent-sockets"}},[t._v("#")]),t._v(" 6.10 "),n("code",[t._v("agent.sockets")])]),t._v(" "),n("ul",[n("li",[n("Object",[t._v("](http://nodejs.cn/s/jzn6Ao)\n")])],1)]),t._v(" "),n("p",[t._v("一个对象，包含尚未分配给"),n("code",[t._v("Socket")]),t._v("的请求队列。 不要修改。")]),t._v(" "),n("h2",{attrs:{id:"_7-http-clientrequest类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-http-clientrequest类"}},[t._v("#")]),t._v(" 7.http.ClientRequest类")]),t._v(" "),n("p",[t._v("继承自: "),n("a",{attrs:{href:"http://nodejs.cn/s/t73H94",target:"_blank",rel:"noopener noreferrer"}},[n("Stream",[n("OutboundLink")],1)],1)]),t._v(" "),n("p",[t._v("源码解读：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClientRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("此对象由 "),n("a",{attrs:{href:"http://nodejs.cn/s/d1myoL",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.request()")]),n("OutboundLink")],1),t._v(" 内部创建并返回。 它代表正在进行中的请求，其请求头已进入队列。 请求头仍然可以使用 "),n("a",{attrs:{href:"http://nodejs.cn/s/ZBShBB",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("setHeader(name, value)")]),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"http://nodejs.cn/s/noVJNv",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("getHeader(name)")]),n("OutboundLink")],1),t._v(" 或 "),n("a",{attrs:{href:"http://nodejs.cn/s/vzuErq",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("removeHeader(name)")]),n("OutboundLink")],1),t._v(" API 进行改变。 实际的请求头将会与第一个数据块一起发送，或者当调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/GAdV2u",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("request.end()")]),n("OutboundLink")],1),t._v(" 时发送。")]),t._v(" "),n("p",[t._v("要获得响应，则为请求对象添加 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件监听器。 当接收到响应头时，会从请求对象中触发 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件。 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件执行时具有一个参数，该参数是 "),n("a",{attrs:{href:"http://nodejs.cn/s/2RqpEw",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.IncomingMessage")]),n("OutboundLink")],1),t._v(" 的实例。")]),t._v(" "),n("p",[t._v("在 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件期间，可以添加监听器到响应对象，比如监听 "),n("code",[t._v("'data'")]),t._v(" 事件。")]),t._v(" "),n("p",[t._v("如果没有添加 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件处理函数，则响应将会被完全地丢弃。 如果添加了 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件处理函数，则必须消费完响应对象中的数据，每当有 "),n("code",[t._v("'readable'")]),t._v(" 事件时调用 "),n("code",[t._v("response.read()")]),t._v("、或添加 "),n("code",[t._v("'data'")]),t._v(" 事件处理函数、或通过调用 "),n("code",[t._v(".resume()")]),t._v(" 方法。 在消费完数据之前，不会触发 "),n("code",[t._v("'end'")]),t._v(" 事件。 此外，在读取数据之前，它将会占用内存，这最终可能导致进程内存不足的错误。")]),t._v(" "),n("p",[t._v("与 "),n("code",[t._v("request")]),t._v(" 对象不同，如果响应过早地关闭，则 "),n("code",[t._v("response")]),t._v(" 对象不会触发 "),n("code",[t._v("'error'")]),t._v(" 事件而是触发 "),n("code",[t._v("'aborted'")]),t._v(" 事件。")]),t._v(" "),n("p",[t._v("Node.js 不会检查 Content-Length 和已传输的请求体的长度是否相等。")]),t._v(" "),n("h3",{attrs:{id:"_7-1-http-clientrequest事件监听"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-http-clientrequest事件监听"}},[t._v("#")]),t._v(" 7.1 http.ClientRequest事件监听")]),t._v(" "),n("h4",{attrs:{id:"_7-1-1-abort-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-1-abort-事件"}},[t._v("#")]),t._v(" 7.1.1 'abort' 事件")]),t._v(" "),n("p",[t._v("当请求被客户端中止时触发。 此事件仅在第一次调用 "),n("code",[t._v("abort()")]),t._v(" 时触发。")]),t._v(" "),n("h4",{attrs:{id:"_7-1-2-connect-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-2-connect-事件"}},[t._v("#")]),t._v(" 7.1.2 'connect' 事件")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("response")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2RqpEw",target:"_blank",rel:"noopener noreferrer"}},[t._v("httpIncomingMessage"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("code",[t._v("socket")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("stream.Duplex"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("code",[t._v("head")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/6x1hD3",target:"_blank",rel:"noopener noreferrer"}},[t._v("Buffer"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("每次服务器使用 "),n("code",[t._v("CONNECT")]),t._v(" 方法响应请求时都会触发。 如果未监听此事件，则接收 "),n("code",[t._v("CONNECT")]),t._v(" 方法的客户端将关闭其连接。")]),t._v(" "),n("p",[t._v("此事件保证传入 "),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("net.Socket"),n("OutboundLink")],1),t._v(" 类（"),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("stream.Duplex"),n("OutboundLink")],1),t._v(" 的子类）的实例，除非用户指定了 "),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("net.Socket"),n("OutboundLink")],1),t._v(" 以外的"),n("code",[t._v("Socket")]),t._v("类型。")]),t._v(" "),n("p",[t._v("客户端和服务器对演示了如何监听 "),n("code",[t._v("'connect'")]),t._v(" 事件：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" net "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'net'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 HTTP 隧道代理。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" proxy "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'响应内容'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'connect'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" clientSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 连接到原始服务器。")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hostname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("URL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("http://")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serverSocket "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" net"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    clientSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP/1.1 200 Connection Established\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Proxy-agent: Node.js-Proxy\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\r\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    serverSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("head"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    serverSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("clientSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    clientSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverSocket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 代理正在运行。")]),t._v("\nproxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向隧道代理发出请求。")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'CONNECT'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nodejs.cn:80'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'connect'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'已连接'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过 HTTP 隧道发出请求。")]),t._v("\n    socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET / HTTP/1.1\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                 "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Host: nodejs.cn:80\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                 "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Connection: close\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                 "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\r\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      proxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h4",{attrs:{id:"_7-1-3-continue-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-3-continue-事件"}},[t._v("#")]),t._v(" 7.1.3 'continue' 事件")]),t._v(" "),n("p",[t._v("当服务器发送 "),n("code",[t._v("100 Continue")]),t._v(" HTTP 响应时触发，通常是因为请求包含 "),n("code",[t._v("Expect: 100-continue")]),t._v("。 这是客户端应发送请求主体的指令。")]),t._v(" "),n("h4",{attrs:{id:"_7-1-4-information-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-4-information-事件"}},[t._v("#")]),t._v(" 7.1.4 'information' 事件")]),t._v(" "),n("p",[n("code",[t._v("info")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),t._v(" "),n("ul",[n("li",[n("code",[t._v("httpVersion")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("httpVersionMajor")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("httpVersionMinor")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("statusCode")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("integer",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("statusMessage")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("headers")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("rawHeaders")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[t._v("<string[]>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("服务器发送 1xx 中间响应（不包括 101 Upgrade）时触发。 此事件的监听器将会接收一个对象，该对象包含 HTTP 版本，状态码，状态消息，键值对请求头对象、以及具有原始请求头名称和值的数组。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/length_request'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发出请求。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'information'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("info")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("获得主响应之前的信息: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("code",[t._v("101 Upgrade")]),t._v(" 状态不会触发此事件，因为它们与传统的 HTTP 请求/响应链断开，例如 Web "),n("code",[t._v("Socket")]),t._v("、现场 TLS 升级、或 HTTP 2.0。 要收到 "),n("code",[t._v("101 Upgrade")]),t._v(" 的通知，请改为监听 "),n("a",{attrs:{href:"http://nodejs.cn/s/xjUtig",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'upgrade'")]),n("OutboundLink")],1),t._v(" 事件。")]),t._v(" "),n("h4",{attrs:{id:"_7-1-5-response-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-5-response-事件"}},[t._v("#")]),t._v(" 7.1.5 'response' 事件")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("response")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2RqpEw",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.IncomingMessage>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("当收到此请求的响应时触发。 此事件仅触发一次。")]),t._v(" "),n("h4",{attrs:{id:"_7-1-6-socket-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-6-socket-事件"}},[t._v("#")]),t._v(" 7.1.6 'socket' 事件")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("socket")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("此事件保证传入 "),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<net.Socket>"),n("OutboundLink")],1),t._v(" 类（"),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1),t._v(" 的子类）的实例，除非用户指定了 "),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<net.Socket>"),n("OutboundLink")],1),t._v(" 以外的"),n("code",[t._v("Socket")]),t._v("类型。")]),t._v(" "),n("h4",{attrs:{id:"_7-1-7-timeout-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-7-timeout-事件"}},[t._v("#")]),t._v(" 7.1.7 'timeout' 事件")]),t._v(" "),n("p",[t._v("当底层"),n("code",[t._v("Socket")]),t._v("因不活动而超时时触发。 这只会通知"),n("code",[t._v("Socket")]),t._v("已空闲。 必须手动中止请求。")]),t._v(" "),n("p",[t._v("另请参见："),n("a",{attrs:{href:"http://nodejs.cn/s/qX7N7E",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("request.setTimeout()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h4",{attrs:{id:"_7-1-8-upgrade-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-8-upgrade-事件"}},[t._v("#")]),t._v(" 7.1.8 'upgrade' 事件")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("response")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2RqpEw",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.IncomingMessage>"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("code",[t._v("socket")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("code",[t._v("head")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/6x1hD3",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("每次服务器响应升级请求时发出。 如果未监听此事件且响应状态码为 "),n("code",[t._v("101 Switching Protocols")]),t._v("，则接收升级响应头的客户端将关闭其连接。")]),t._v(" "),n("p",[t._v("此事件保证传入"),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<net.Socket>"),n("OutboundLink")],1),t._v("类（"),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1),t._v("的子类）的实例，除非用户指定了"),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<net.Socket>"),n("OutboundLink")],1),t._v("以外的"),n("code",[t._v("Socket")]),t._v("类型。")]),t._v(" "),n("p",[t._v("客户端服务器对，演示如何监听 "),n("code",[t._v("'upgrade'")]),t._v(" 事件。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建 HTTP 服务器。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'响应内容'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'upgrade'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" head")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP/1.1 101 Web Socket Protocol Handshake\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n               "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upgrade: WebSocket\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n               "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Connection: Upgrade\\r\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n               "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\r\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pipe")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 响应回去。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 服务器正在运行。")]),t._v("\nserver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求。")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1337")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    headers"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Connection'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upgrade'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Upgrade'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'websocket'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'upgrade'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" upgradeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'接收到响应'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-2-request-aborted"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-request-aborted"}},[t._v("#")]),t._v(" 7.2 "),n("code",[t._v("request.aborted")])]),t._v(" "),n("boolean",[n("p",[t._v("如果请求已中止，则 "),n("code",[t._v("request.aborted")]),t._v(" 属性将会为 "),n("code",[t._v("true")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_7-3-request-end-data-encoding-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-request-end-data-encoding-callback"}},[t._v("#")]),t._v(" 7.3 "),n("code",[t._v("request.end([data[, encoding]][, callback])")])]),t._v(" "),n("ul",[n("li",[t._v("data: "),n("string",[t._v(" | "),n("Buffer")],1)],1),t._v(" "),n("li",[t._v("encoding: "),n("string")],1),t._v(" "),n("li",[t._v("callback: "),n("function")],1),t._v(" "),n("li",[t._v("返回：this ---\x3e request，即 可以链式调用")])]),t._v(" "),n("h3",{attrs:{id:"_7-4-request-destroy-error"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-request-destroy-error"}},[t._v("#")]),t._v(" 7.4 "),n("code",[t._v("request.destroy([error])")])]),t._v(" "),n("ul",[n("li",[t._v("error: "),n("Error")],1),t._v(" "),n("li",[t._v("返回： this")])]),t._v(" "),n("h5",{attrs:{id:"_7-5-request-destroyed"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-request-destroyed"}},[t._v("#")]),t._v(" 7.5 "),n("code",[t._v("request.destroyed")])]),t._v(" "),n("boolean",[n("p",[t._v("在"),n("code",[t._v("request.destroyed")]),t._v("调用之后变为"),n("code",[t._v("true")])]),t._v(" "),n("h3",{attrs:{id:"_7-6-request-flushheaders"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-request-flushheaders"}},[t._v("#")]),t._v(" 7.6  "),n("code",[t._v("request.flushHeaders()")])]),t._v(" "),n("p",[t._v("刷新请求头。")]),t._v(" "),n("p",[t._v("出于效率原因，Node.js 通常会缓冲请求头，直到调用 "),n("code",[t._v("request.end()")]),t._v(" 或写入第一个请求数据块。 然后，它尝试将请求头和数据打包到单个 TCP 数据包中。")]),t._v(" "),n("p",[t._v("这通常是期望的（它节省了 TCP 往返），但是可能很晚才发送第一个数据。 "),n("code",[t._v("request.flushHeaders()")]),t._v(" 绕过优化并启动请求。")]),t._v(" "),n("h3",{attrs:{id:"_7-7-request-getheader-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-7-request-getheader-name"}},[t._v("#")]),t._v(" 7.7 "),n("code",[t._v("request.getHeader(name)")])]),t._v(" "),n("ul",[n("li",[n("p",[t._v("name: "),n("string")],1)]),t._v(" "),n("li",[n("p",[t._v("返回："),n("any")],1)])]),t._v(" "),n("p",[t._v("读取请求中的一个请求头。 该名称不区分大小写。 返回值的类型取决于提供给 "),n("a",{attrs:{href:"http://nodejs.cn/s/ZBShBB",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("request.setHeader()")]),n("OutboundLink")],1),t._v(" 的参数。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nrequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Length'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("byteLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nrequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type=ninja'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'language=javascript'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contentType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'contentType' 是 'text/html'。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contentLength "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Length'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'contentLength' 的类型为数值。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cookie "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 'cookie' 的类型为字符串数组。")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-8-request-maxheaderscount"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-8-request-maxheaderscount"}},[t._v("#")]),t._v(" 7.8 "),n("code",[t._v("request.maxHeadersCount")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" "),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("2000")]),t._v("。")])]),t._v(" "),n("p",[t._v("限制最大响应头数。 如果设置为 "),n("code",[t._v("0")]),t._v("，则不会应用任何限制。")]),t._v(" "),n("h3",{attrs:{id:"_7-9-request-path"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-9-request-path"}},[t._v("#")]),t._v(" 7.9 "),n("code",[t._v("request.path")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 请求的路径。")])]),t._v(" "),n("h3",{attrs:{id:"_7-10-request-removeheader-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-10-request-removeheader-name"}},[t._v("#")]),t._v(" 7.10 "),n("code",[t._v("request.removeHeader(name)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("移除已定义到请求头对象中的请求头。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-11-request-setheader-name-value"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-11-request-setheader-name-value"}},[t._v("#")]),t._v(" 7.11 "),n("code",[t._v("request.setHeader(name, value)")])]),t._v(" "),n("ul",[n("li",[t._v("name: "),n("string")],1),t._v(" "),n("li",[t._v("value: "),n("any")],1)]),t._v(" "),n("p",[t._v("为请求头对象设置单个请求头的值。")]),t._v(" "),n("p",[t._v("如果此请求头已存在于待发送的请求头中，则其值将被替换。 这里可以使用字符串数组来发送具有相同名称的多个请求头。 非字符串值将被原样保存。 因此 "),n("a",{attrs:{href:"http://nodejs.cn/s/noVJNv",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("request.getHeader()")]),n("OutboundLink")],1),t._v(" 可能会返回非字符串值。 但是非字符串值将转换为字符串以进行网络传输。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或：")]),t._v("\nrequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type=ninja'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'language=javascript'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-12-request-setnodelay-nodelay"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-12-request-setnodelay-nodelay"}},[t._v("#")]),t._v(" 7.12 "),n("code",[t._v("request.setNoDelay([noDelay])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("noDelay")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("一旦将"),n("code",[t._v("Socket")]),t._v("分配给此请求并且连接了"),n("code",[t._v("Socket")]),t._v("，就会调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/q9UswY",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("socket.setNoDelay()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_7-13-request-setsocketkeepalive-enable-initialdelay"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-13-request-setsocketkeepalive-enable-initialdelay"}},[t._v("#")]),t._v(" 7.13 "),n("code",[t._v("request.setSocketKeepAlive([enable][, initialDelay])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("enable")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("initialDelay")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("一旦将"),n("code",[t._v("Socket")]),t._v("分配给此请求并连接了"),n("code",[t._v("Socket")]),t._v("，就会调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/qqbgUD",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("socket.setKeepAlive()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_7-14-request-settimeout-timeout-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-14-request-settimeout-timeout-callback"}},[t._v("#")]),t._v(" 7.14 "),n("code",[t._v("request.setTimeout(timeout[, callback])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("timeout")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 请求超时前的毫秒数。")]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("function",[n("OutboundLink")],1)],1),t._v(" 发生超时时要调用的可选函数。相当于绑定到 "),n("code",[t._v("'timeout'")]),t._v(" 事件。")]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/2F5RHd",target:"_blank",rel:"noopener noreferrer"}},[t._v("http.ClientRequest"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("一旦将"),n("code",[t._v("Socket")]),t._v("分配给此请求并且连接了"),n("code",[t._v("Socket")]),t._v("，就会调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/XC4Yyj",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("socket.setTimeout()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_7-15-request-socket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-15-request-socket"}},[t._v("#")]),t._v(" 7.15 "),n("code",[t._v("request.socket")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("指向底层"),n("code",[t._v("Socket")]),t._v("。 通常用户无需访问此属性。 特别是，由于协议解析器附加到"),n("code",[t._v("Socket")]),t._v("的方式，"),n("code",[t._v("Socket")]),t._v("将不会触发 "),n("code",[t._v("'readable'")]),t._v(" 事件。 也可以通过 "),n("code",[t._v("request.connection")]),t._v(" 访问 "),n("code",[t._v("socket")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  host"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nodejs.cn'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("once")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'response'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ip "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" port "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("localPort"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("您的 IP 地址是 ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("，源端口是 ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用响应对象。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_7-16-request-writablefinished"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-16-request-writablefinished"}},[t._v("#")]),t._v(" 7.16 "),n("code",[t._v("request.writableFinished")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[t._v("boolean"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("如果在触发 "),n("a",{attrs:{href:"http://nodejs.cn/s/yLFDX9",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'finish'")]),n("OutboundLink")],1),t._v(" 事件之前，所有数据都已刷新到底层系统，则为 "),n("code",[t._v("true")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_7-17-request-write-chunk-encoding-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-17-request-write-chunk-encoding-callback"}},[t._v("#")]),t._v(" 7.17 "),n("code",[t._v("request.write(chunk[, encoding][, callback])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("chunk")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/s/6x1hD3",target:"_blank",rel:"noopener noreferrer"}},[n("OutboundLink")],1)]),t._v(" "),n("li",[n("code",[t._v("encoding")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("function",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("发送一个请求主体的数据块。 通过多次调用此方法，可以将请求主体发送到服务器。 在这种情况下，建议在创建请求时使用 "),n("code",[t._v("['Transfer-Encoding', 'chunked']")]),t._v(" 请求头行。")]),t._v(" "),n("p",[n("code",[t._v("encoding")]),t._v(" 参数是可选的，仅当 "),n("code",[t._v("chunk")]),t._v(" 是字符串时才适用。 默认为 "),n("code",[t._v("'utf8'")]),t._v("。")]),t._v(" "),n("p",[n("code",[t._v("callback")]),t._v(" 参数是可选的，当刷新此数据块时调用，但仅当数据块非空时才会调用。")]),t._v(" "),n("p",[t._v("如果将整个数据成功刷新到内核缓冲区，则返回 "),n("code",[t._v("true")]),t._v("。 如果全部或部分数据在用户内存中排队，则返回 "),n("code",[t._v("false")]),t._v("。 当缓冲区再次空闲时，则触发 "),n("code",[t._v("'drain'")]),t._v(" 事件。")]),t._v(" "),n("p",[t._v("当使用空字符串或 buffer 调用 "),n("code",[t._v("write")]),t._v(" 函数时，则什么也不做且等待更多输入。")]),t._v(" "),n("h3",{attrs:{id:"_7-17-request-reusedsocket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-17-request-reusedsocket"}},[t._v("#")]),t._v(" 7.17 "),n("code",[t._v("request.reusedSocket")])]),t._v(" "),n("boolean",[n("p",[t._v("判断"),n("code",[t._v("request")]),t._v("是否是通过一个被拒绝的"),n("code",[t._v("socket")]),t._v("发送。")]),t._v(" "),n("p",[t._v("当通过启用保持"),n("code",[t._v("keep-alive")]),t._v(" 的代理发送请求时，底层的"),n("code",[t._v("socket")]),t._v("可能會被拒絕。但是，如果服务器在不幸的时间关闭连接，则客户端可能会遇到“ ECONNRESET”错误。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Server has a 5 seconds keep-alive timeout by default")]),t._v("\nhttp\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello\\n'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Adapting a keep-alive agent")]),t._v("\n  http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:3000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do nothing")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Sending request on 5s interval so it's easy to hit idle timeout")]),t._v("\n")])])]),n("p",[t._v("通过判断"),n("code",[t._v("req.reusedSocket")]),t._v("的值，我们可以再次重新启用连接，从而避免这个错误：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" agent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Agent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" keepAlive"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("retriableRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:3000'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Check if retry is needed")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reusedSocket "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("code "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ECONNRESET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("retriableRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("retriableRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"_8-http-serverresponse-类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-http-serverresponse-类"}},[t._v("#")]),t._v(" 8.http.ServerResponse 类")]),t._v(" "),n("p",[t._v("继承自: "),n("a",{attrs:{href:"http://nodejs.cn/s/t73H94",target:"_blank",rel:"noopener noreferrer"}},[n("Stream",[n("OutboundLink")],1)],1)]),t._v(" "),n("p",[t._v("源码解读：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  ServerResponse\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_http_server'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  ServerResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("code",[t._v("http.ServerResponse")]),t._v(" 类直接将"),n("code",[t._v("_http_server")]),t._v("中的"),n("code",[t._v("ServerResponse")]),t._v("引入并导出。")]),t._v(" "),n("p",[t._v("此对象由 HTTP 服务器在内部创建，而不是由用户创建。 它作为第二个参数传给 "),n("a",{attrs:{href:"http://nodejs.cn/s/2qCn57",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'request'")]),n("OutboundLink")],1),t._v(" 事件。—— "),n("a",{attrs:{href:"http://nodejs.cn/api/http.html#http_class_http_serverresponse",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),n("OutboundLink")],1)]),t._v(" "),n("h3",{attrs:{id:"_8-1-http-serverresponse-事件监听"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-http-serverresponse-事件监听"}},[t._v("#")]),t._v(" 8.1 http.ServerResponse 事件监听")]),t._v(" "),n("h4",{attrs:{id:"_8-1-1-close-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-1-close-事件"}},[t._v("#")]),t._v(" 8.1.1 'close' 事件")]),t._v(" "),n("p",[t._v("表明底层的连接已被终止。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'close'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h4",{attrs:{id:"_8-1-2-finish-事件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-2-finish-事件"}},[t._v("#")]),t._v(" 8.1.2 'finish' 事件")]),t._v(" "),n("p",[t._v("响应发送后触发。 更具体地说，当响应头和主体的最后一段已经切换到操作系统以通过网络传输时，触发该事件。 这并不意味着客户端已收到任何信息。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'finish'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-2-response-cork"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-response-cork"}},[t._v("#")]),t._v(" 8.2 "),n("code",[t._v("response.cork()")])]),t._v(" "),n("p",[t._v("继承自stream.Writable 类,同 "),n("a",{attrs:{href:"http://nodejs.cn/s/HbaGHW",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("writable.cork()")]),n("OutboundLink")],1)]),t._v(" "),n("p",[n("code",[t._v("writable.cork()")]),t._v(" 方法强制把所有写入的数据都缓冲到内存中。 当调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/2Bzt8L",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("stream.uncork()")]),n("OutboundLink")],1),t._v(" 或 "),n("a",{attrs:{href:"http://nodejs.cn/s/nvArK4",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("stream.end()")]),n("OutboundLink")],1),t._v(" 方法时，缓冲的数据才会被输出。")]),t._v(" "),n("p",[n("code",[t._v("writable.cork()")]),t._v(" 的主要目的是为了适应将几个数据快速连续地写入流的情况。 "),n("code",[t._v("writable.cork()")]),t._v(" 不会立即将它们转发到底层的目标，而是缓冲所有数据块，直到调用 "),n("code",[t._v("writable.uncork()")]),t._v("，这会将它们全部传给 "),n("code",[t._v("writable._writev()")]),t._v("（如果存在）。 这可以防止出现行头阻塞的情况，在这种情况下，正在等待第一个数据块被处理的同时对数据进行缓冲。 但是，使用 "),n("code",[t._v("writable.cork()")]),t._v(" 而不实现 "),n("code",[t._v("writable._writev()")]),t._v(" 可能会对吞吐量产生不利影响。")]),t._v(" "),n("h3",{attrs:{id:"_8-3-response-end-data-encoding-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-response-end-data-encoding-callback"}},[t._v("#")]),t._v(" 8.3 "),n("code",[t._v("response.end([data[, encoding]][, callback])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("data")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/s/6x1hD3",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("encoding")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回："),n("this")],1)]),t._v(" "),n("p",[t._v("此方法向服务器发出信号，表明已发送所有响应头和主体，该服务器应该视为此消息已完成。 必须在每个响应上调用此 "),n("code",[t._v("response.end()")]),t._v(" 方法。")]),t._v(" "),n("p",[t._v("如果指定了 "),n("code",[t._v("data")]),t._v("，则相当于调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/gvWo3m",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.write(data, encoding)")]),n("OutboundLink")],1),t._v(" 之后再调用 "),n("code",[t._v("response.end(callback)")]),t._v("。")]),t._v(" "),n("p",[t._v("如果指定了 "),n("code",[t._v("callback")]),t._v("，则当响应流完成时将调用它。")]),t._v(" "),n("h3",{attrs:{id:"_8-4-response-flushheaders"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-4-response-flushheaders"}},[t._v("#")]),t._v(" 8.4 "),n("code",[t._v("response.flushHeaders()")])]),t._v(" "),n("p",[t._v("刷新响应头。 另可参见："),n("a",{attrs:{href:"http://nodejs.cn/s/JcwoXr",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("request.flushHeaders()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_8-5-response-getheader-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-5-response-getheader-name"}},[t._v("#")]),t._v(" 8.5 "),n("code",[t._v("response.getHeader(name)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("读出已排队但未发送到客户端的响应头。 该名称不区分大小写。 返回值的类型取决于提供给 "),n("a",{attrs:{href:"http://nodejs.cn/s/rqeM3J",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.setHeader()")]),n("OutboundLink")],1),t._v(" 的参数。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Length'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("byteLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type=ninja'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'language=javascript'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contentType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// contentType 是 'text/html'。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contentLength "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Length'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// contentLength 的类型为数值。")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" setCookie "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'set-cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setCookie 的类型为字符串数组。")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-6-response-getheadernames"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-6-response-getheadernames"}},[t._v("#")]),t._v(" 8.6 "),n("code",[t._v("response.getHeaderNames()")])]),t._v(" "),n("ul",[n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[t._v("<string[]>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("返回一个数组，其中包含当前传出的响应头的唯一名称。 所有响应头名称都是小写的。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo=bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar=baz'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" headerNames "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeaderNames")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// headerNames === ['foo', 'set-cookie']")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-7-response-getheaders"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-7-response-getheaders"}},[t._v("#")]),t._v(" 8.7 "),n("code",[t._v("response.getHeaders()")])]),t._v(" "),n("ul",[n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("返回当前传出的响应头的浅拷贝。 由于使用浅拷贝，因此可以更改数组的值而无需额外调用各种与响应头相关的 http 模块方法。 返回对象的键是响应头名称，值是各自的响应头值。 所有响应头名称都是小写的。")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("response.getHeaders()")]),t._v(" 方法返回的对象不是从 JavaScript "),n("code",[t._v("Object")]),t._v(" 原型继承的")]),t._v("。 这意味着典型的 "),n("code",[t._v("Object")]),t._v(" 方法，如 "),n("code",[t._v("obj.toString()")]),t._v("、 "),n("code",[t._v("obj.hasOwnProperty()")]),t._v(" 等都没有定义并且不起作用。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo=bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar=baz'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" headers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// headers === { foo: 'bar', 'set-cookie': ['foo=bar', 'bar=baz'] }")]),t._v("\n")])])]),n("p",[t._v("源码解读：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Returns a shallow copy of the current outgoing headers.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("OutgoingMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getHeaders")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" headers "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kOutHeaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ret "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对象不是从 JavaScript `Object` 原型继承的，生成一个纯粹的 {}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" keys "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" keys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" key "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" keys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" val "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" val"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),n("p",[t._v("可以看出"),n("code",[t._v("response")]),t._v("是"),n("code",[t._v("OutgoingMessage")]),t._v("的实例化对象。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeaders")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OutgoingMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7777")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-8-response-hasheader-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-8-response-hasheader-name"}},[t._v("#")]),t._v(" 8.8 "),n("code",[t._v("response.hasHeader(name)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("如果当前在传出的响应头中设置了由 "),n("code",[t._v("name")]),t._v(" 标识的响应头，则返回 "),n("code",[t._v("true")]),t._v("。 响应头名称匹配不区分大小写。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" hasContentType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-9-response-removeheader-name"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-9-response-removeheader-name"}},[t._v("#")]),t._v(" 8.9 "),n("code",[t._v("response.removeHeader(name)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("移除排队等待中的隐式发送的响应头。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Encoding'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_8-10-response-setheader-name-value"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-10-response-setheader-name-value"}},[t._v("#")]),t._v(" 8.10 "),n("code",[t._v("response.setHeader(name, value)")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("name")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("value")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/6sTGdS",target:"_blank",rel:"noopener noreferrer"}},[n("any",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("为隐式响应头设置单个响应头的值。 如果此响应头已存在于待发送的响应头中，则其值将被替换。 在这里可以使用字符串数组来发送具有相同名称的多个响应头。 非字符串值将被原样保存。 因此 "),n("a",{attrs:{href:"http://nodejs.cn/s/pbE7VN",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.getHeader()")]),n("OutboundLink")],1),t._v(" 可能返回非字符串值。 但是非字符串值将转换为字符串以进行网络传输。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("或：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'type=ninja'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'language=javascript'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("尝试设置包含无效字符的响应头字段名称或值将导致抛出 "),n("a",{attrs:{href:"http://nodejs.cn/s/Z7Lqyj",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("TypeError")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("p",[t._v("当使用 "),n("a",{attrs:{href:"http://nodejs.cn/s/rqeM3J",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.setHeader()")]),n("OutboundLink")],1),t._v(" 设置响应头时，它们将与传给 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v(" 的任何响应头合并，其中 "),n("strong",[n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v(" 的响应头优先")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回 content-type = text/plain")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ok'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("如果调用了 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v(" 方法并且尚未调用此方法，则它将直接将提供的响应头值写入网络通道而不在内部进行缓存，并且响应头上的 "),n("a",{attrs:{href:"http://nodejs.cn/s/pbE7VN",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.getHeader()")]),n("OutboundLink")],1),t._v(" 将不会产生预期的结果。 如果需要渐进的响应头填充以及将来可能的检索和修改，则使用 "),n("a",{attrs:{href:"http://nodejs.cn/s/rqeM3J",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.setHeader()")]),n("OutboundLink")],1),t._v(" 而不是 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_8-11-response-settimeout-msecs-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-11-response-settimeout-msecs-callback"}},[t._v("#")]),t._v(" 8.11 "),n("code",[t._v("response.setTimeout(msecs[, callback])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("msecs")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/rMXoZ1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.ServerResponse>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("将Socket的超时值设置为 "),n("code",[t._v("msecs")]),t._v("。 如果提供了回调，则会将其作为监听器添加到响应对象上的 "),n("code",[t._v("'timeout'")]),t._v(" 事件中。")]),t._v(" "),n("p",[t._v("如果没有 "),n("code",[t._v("'timeout'")]),t._v(" 监听器添加到请求、响应、或服务器，则"),n("code",[t._v("Socket")]),t._v("在超时时将被销毁。 如果有回调处理函数分配给请求、响应、或服务器的 "),n("code",[t._v("'timeout'")]),t._v(" 事件，则必须显式处理超时的"),n("code",[t._v("Socket")]),t._v("。")]),t._v(" "),n("h3",{attrs:{id:"_8-12-response-socket"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-12-response-socket"}},[t._v("#")]),t._v(" 8.12 "),n("code",[t._v("response.socket")])]),t._v(" "),n("p",[n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("指向底层的"),n("code",[t._v("socket")]),t._v("。 通常用户不需要访问此属性。 特别是，由于协议解析器附加到"),n("code",[t._v("socket")]),t._v("的方式，"),n("code",[t._v("socket")]),t._v("将不会触发 "),n("code",[t._v("'readable'")]),t._v(" 事件。 在调用 "),n("code",[t._v("response.end()")]),t._v(" 之后，此属性将为空。 也可以通过 "),n("code",[t._v("response.connection")]),t._v(" 访问 "),n("code",[t._v("socket")]),t._v("。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ip "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remoteAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" port "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("socket"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remotePort"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("您的 IP 地址是 ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("ip"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("，您的源端口是 ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("port"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("此属性保证是 "),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<net.Socket>"),n("OutboundLink")],1),t._v(" 类（"),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("<stream.Duplex>"),n("OutboundLink")],1),t._v(" 的子类）的实例，除非用户指定了 "),n("a",{attrs:{href:"http://nodejs.cn/s/wsJ1o1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<net.Socket>"),n("OutboundLink")],1),t._v(" 以外的"),n("code",[t._v("socket")]),t._v("类型。")]),t._v(" "),n("h3",{attrs:{id:"_8-13-response-statuscode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-13-response-statuscode"}},[t._v("#")]),t._v(" 8.13 "),n("code",[t._v("response.statusCode")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" "),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("200")]),t._v("。")])]),t._v(" "),n("p",[t._v("当使用隐式的响应头时（没有显式地调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v("），此属性控制在刷新响应头时将发送到客户端的状态码。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("响应头发送到客户端后，此属性表示已发送的状态码。")]),t._v(" "),n("h3",{attrs:{id:"_8-14-response-statusmessage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-14-response-statusmessage"}},[t._v("#")]),t._v(" 8.14 "),n("code",[t._v("response.statusMessage")])]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[t._v("当使用隐式的响应头时（没有显式地调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v("），此属性控制在刷新响应头时将发送到客户端的状态消息。 如果保留为 "),n("code",[t._v("undefined")]),t._v("，则将使用状态码的标准消息。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusMessage "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not found'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("响应头发送到客户端后，此属性表示已发送的状态消息。")]),t._v(" "),n("h3",{attrs:{id:"_8-15response-write-chunk-encoding-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-15response-write-chunk-encoding-callback"}},[t._v("#")]),t._v(" 8.15"),n("code",[t._v("response.write(chunk[, encoding][, callback])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("chunk")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/s/6x1hD3",target:"_blank",rel:"noopener noreferrer"}},[n("Buffer",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("encoding")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" "),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("'utf8'")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1)])]),t._v(" "),n("p",[n("code",[t._v("chunk")]),t._v(" 可以是字符串或 buffer。 如果 "),n("code",[t._v("chunk")]),t._v(" 是一个字符串，则第二个参数指定如何将其编码为字节流。 当刷新此数据块时将调用 "),n("code",[t._v("callback")]),t._v("。")]),t._v(" "),n("p",[t._v("第一次调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/gvWo3m",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.write()")]),n("OutboundLink")],1),t._v(" 时，它会将缓冲的响应头信息和主体的第一个数据块发送给客户端。 第二次调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/gvWo3m",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.write()")]),n("OutboundLink")],1),t._v(" 时，Node.js 假定数据将被流式传输，并分别发送新数据。 也就是说，响应被缓冲到主体的第一个数据块。")]),t._v(" "),n("p",[t._v("如果将整个数据成功刷新到内核缓冲区，则返回 "),n("code",[t._v("true")]),t._v("。 如果全部或部分数据在用户内存中排队，则返回 "),n("code",[t._v("false")]),t._v("。 当缓冲区再次空闲时，则触发 "),n("code",[t._v("'drain'")]),t._v(" 事件。")]),t._v(" "),n("h3",{attrs:{id:"_8-16-response-writehead-statuscode-statusmessage-headers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-16-response-writehead-statuscode-statusmessage-headers"}},[t._v("#")]),t._v(" 8.16 "),n("code",[t._v("response.writeHead(statusCode[, statusMessage][, headers])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("statusCode")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("statusMessage")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("headers")]),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/rMXoZ1",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.ServerResponse>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("向请求发送响应头。 状态码是一个 3 位的 HTTP 状态码，如 "),n("code",[t._v("404")]),t._v("。 最后一个参数 "),n("code",[t._v("headers")]),t._v(" 是响应头。 可以可选地将用户可读的 "),n("code",[t._v("statusMessage")]),t._v(" 作为第二个参数。")]),t._v(" "),n("p",[t._v("返回对 "),n("code",[t._v("ServerResponse")]),t._v(" 的引用，以便可以链式调用。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nresponse\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Length'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("byteLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("此方法只能在消息上调用一次，并且必须在调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/sqAtet",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.end()")]),n("OutboundLink")],1),t._v(" 之前调用。")]),t._v(" "),n("p",[t._v("当使用 "),n("a",{attrs:{href:"http://nodejs.cn/s/rqeM3J",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.setHeader()")]),n("OutboundLink")],1),t._v(" 设置响应头时，则与传给 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v(" 的任何响应头合并，且 "),n("a",{attrs:{href:"http://nodejs.cn/s/fnj9oM",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.writeHead()")]),n("OutboundLink")],1),t._v(" 的优先。")]),t._v(" "),n("p",[t._v("如果调用此方法并且尚未调用 "),n("a",{attrs:{href:"http://nodejs.cn/s/rqeM3J",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.setHeader()")]),n("OutboundLink")],1),t._v("，则直接将提供的响应头值写入网络通道而不在内部进行缓存，响应头上的 "),n("a",{attrs:{href:"http://nodejs.cn/s/pbE7VN",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.getHeader()")]),n("OutboundLink")],1),t._v(" 将不会产生预期的结果。 如果需要渐进的响应头填充以及将来可能的检索和修改，则改用 "),n("a",{attrs:{href:"http://nodejs.cn/s/rqeM3J",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("response.setHeader()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回 content-type = text/plain")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" server "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'X-Foo'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'bar'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ok'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("code",[t._v("Content-Length")]),t._v(" 以字节而非字符为单位。 使用 "),n("code",[t._v("Buffer.byteLength()")]),t._v(" 来判断主体的长度（以字节为单位）。 Node.js 不检查 "),n("code",[t._v("Content-Length")]),t._v(" 和已传输的主体的长度是否相等。")]),t._v(" "),n("p",[t._v("尝试设置包含无效字符的响应头字段名称或值将导致抛出 "),n("a",{attrs:{href:"http://nodejs.cn/s/Z7Lqyj",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("TypeError")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"_9-http-get-options-callback-和http-get-url-options-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-http-get-options-callback-和http-get-url-options-callback"}},[t._v("#")]),t._v(" 9."),n("code",[t._v("http.get(options[, callback])")]),t._v("和"),n("code",[t._v("http.get(url[, options][, callback])")])]),t._v(" "),n("ul",[n("li",[n("code",[t._v("url")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/s/5dwq7G",target:"_blank",rel:"noopener noreferrer"}},[n("URL",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" 接受与 "),n("a",{attrs:{href:"http://nodejs.cn/s/d1myoL",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.request()")]),n("OutboundLink")],1),t._v(" 相同的 "),n("code",[t._v("options")]),t._v("，且 "),n("code",[t._v("method")]),t._v(" 始终设置为 "),n("code",[t._v("GET")]),t._v("。从原型继承的属性将被忽略。")]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),t._v(", "),n("code",[t._v("callback")]),t._v(" 调用时只有一个参数，该参数是 "),n("a",{attrs:{href:"http://nodejs.cn/s/2RqpEw",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.IncomingMessage")]),n("OutboundLink")],1),t._v(" 的实例。")]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/2F5RHd",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.ClientRequest>"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("这个方法与 "),n("a",{attrs:{href:"http://nodejs.cn/s/d1myoL",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.request()")]),n("OutboundLink")],1),t._v(" 的唯一区别是它将方法设置为 GET 并自动调用 "),n("code",[t._v("req.end()")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://nodejs.cn/index.json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" statusCode "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" contentType "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("statusCode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    error "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请求失败\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                      "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("状态码: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("statusCode"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/^application\\/json/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("contentType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    error "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'无效的 content-type.\\n'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                      "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("期望的是 application/json 但接收到的是 ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("contentType"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 消费响应数据来释放内存。")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resume")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEncoding")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" rawData "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" rawData "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" chunk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parsedData "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rawData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parsedData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("出现错误: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h2",{attrs:{id:"_10-http-request-options-callback-和http-request-url-options-callback"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-http-request-options-callback-和http-request-url-options-callback"}},[t._v("#")]),t._v(" 10. "),n("code",[t._v("http.request(options[, callback])")]),t._v("和"),n("code",[t._v("http.request(url[, options][, callback])")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" postData "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" querystring"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'你好世界'")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" options "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  hostname"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'nodejs.cn'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  port"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  path"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/upload'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  headers"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/x-www-form-urlencoded'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Length'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("byteLength")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("postData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("状态码: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statusCode"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("响应头: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setEncoding")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("响应主体: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("chunk"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'响应中已无数据'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("请求遇到问题: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将数据写入请求主体。")]),t._v("\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("postData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须始终调用 req.end() 来表示请求的结束")]),t._v("\nreq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[n("code",[t._v("url")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/s/5dwq7G",target:"_blank",rel:"noopener noreferrer"}},[n("URL",[n("OutboundLink")],1)],1)]),t._v(" "),n("li",[n("code",[t._v("options")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" "),n("ul",[n("li",[n("code",[t._v("agent")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/HRCnER",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.Agent>"),n("OutboundLink")],1),t._v(" | "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),t._v(" 控制 "),n("a",{attrs:{href:"http://nodejs.cn/s/HRCnER",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("Agent")]),n("OutboundLink")],1),t._v(" 的行为。可能的值有：\n"),n("ul",[n("li",[n("code",[t._v("undefined")]),t._v(" (默认): 对此主机和端口使用 "),n("a",{attrs:{href:"http://nodejs.cn/s/g7BhW2",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("http.globalAgent")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("Agent")]),t._v(" 对象: 显式地使用传入的 "),n("code",[t._v("Agent")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("false")]),t._v(": 使用新建的具有默认值的 "),n("code",[t._v("Agent")]),t._v("。")])])]),t._v(" "),n("li",[n("code",[t._v("auth")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 基本的身份验证，即 "),n("code",[t._v("'user:password'")]),t._v("，用于计算授权请求头。")]),t._v(" "),n("li",[n("code",[t._v("createConnection")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),t._v(" 当 "),n("code",[t._v("agent")]),t._v(" 选项未被使用时，用来为请求生成套接字或流的函数。这可用于避免创建自定义的 "),n("code",[t._v("Agent")]),t._v(" 类以覆盖默认的 "),n("code",[t._v("createConnection")]),t._v(" 函数。详见 "),n("a",{attrs:{href:"http://nodejs.cn/s/nH3X12",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("agent.createConnection()")]),n("OutboundLink")],1),t._v("。任何"),n("a",{attrs:{href:"http://nodejs.cn/s/2iRabr",target:"_blank",rel:"noopener noreferrer"}},[t._v("双工流"),n("OutboundLink")],1),t._v("都是有效的返回值。")]),t._v(" "),n("li",[n("code",[t._v("defaultPort")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 协议的默认端口。 如果使用 "),n("code",[t._v("Agent")]),t._v("，则默认值为 "),n("code",[t._v("agent.defaultPort")]),t._v("，否则为 "),n("code",[t._v("undefined")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("family")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 当解析 "),n("code",[t._v("host")]),t._v(" 或 "),n("code",[t._v("hostname")]),t._v(" 时使用的 IP 地址族。有效值为 "),n("code",[t._v("4")]),t._v(" 或 "),n("code",[t._v("6")]),t._v("。如果没有指定，则同时使用 IP v4 和 v6。")]),t._v(" "),n("li",[n("code",[t._v("headers")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jzn6Ao",target:"_blank",rel:"noopener noreferrer"}},[n("Object",[n("OutboundLink")],1)],1),t._v(" 包含请求头的对象。")]),t._v(" "),n("li",[n("code",[t._v("host")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 请求发送至的服务器的域名或 IP 地址。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("'localhost'")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("hostname")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" "),n("code",[t._v("host")]),t._v(" 的别名。为了支持 "),n("a",{attrs:{href:"http://nodejs.cn/s/b28B2A",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("url.parse()")]),n("OutboundLink")],1),t._v("，如果同时指定 "),n("code",[t._v("host")]),t._v(" 和 "),n("code",[t._v("hostname")]),t._v("，则使用 "),n("code",[t._v("hostname")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("insecureHTTPParser")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),t._v(" 使用不安全的 HTTP 解析器，当为 "),n("code",[t._v("true")]),t._v(" 时接受无效的 HTTP 请求头。应避免使用不安全的解析器。有关更多信息，参见 "),n("a",{attrs:{href:"http://nodejs.cn/s/5Bnm43",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("--insecure-http-parser")]),n("OutboundLink")],1),t._v("。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("false")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("localAddress")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 为网络连接绑定的本地接口。")]),t._v(" "),n("li",[n("code",[t._v("lookup")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),t._v(" 自定义的查找函数。 "),n("strong",[t._v("默认值:")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/LJLsTL",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("dns.lookup()")]),n("OutboundLink")],1),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("maxHeaderSize")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 可选地，重写此服务器接收的请求的 "),n("a",{attrs:{href:"http://nodejs.cn/s/HfsyuU",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("--max-http-header-size")]),n("OutboundLink")],1),t._v(" 值，即请求头的最大长度（以字节为单位）。 "),n("strong",[t._v("默认值:")]),t._v(" 16384（16KB）。")]),t._v(" "),n("li",[n("code",[t._v("method")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 一个字符串，指定 HTTP 请求的方法。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("'GET'")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("path")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 请求的路径。应包括查询字符串（如果有）。例如 "),n("code",[t._v("'/index.html?page=12'")]),t._v("。当请求的路径包含非法的字符时，则抛出异常。目前只有空格被拒绝，但未来可能会有所变化。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("'/'")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("port")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(" 远程服务器的端口。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("defaultPort")]),t._v("（如果有设置）或 "),n("code",[t._v("80")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("protocol")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" 使用的协议。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("'http:'")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("setHost")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/jFbvuT",target:"_blank",rel:"noopener noreferrer"}},[n("boolean",[n("OutboundLink")],1)],1),t._v(": 指定是否自动添加 "),n("code",[t._v("Host")]),t._v(" 请求头。"),n("strong",[t._v("默认值:")]),t._v(" "),n("code",[t._v("true")]),t._v("。")]),t._v(" "),n("li",[n("code",[t._v("socketPath")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/9Tw2bK",target:"_blank",rel:"noopener noreferrer"}},[n("string",[n("OutboundLink")],1)],1),t._v(" Unix 域套接字。如果指定了 "),n("code",[t._v("host")]),t._v(" 或 "),n("code",[t._v("port")]),t._v(" 之一（它们指定了 TCP 套接字），则不能使用此选项。")]),t._v(" "),n("li",[n("code",[t._v("timeout")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/SXbo1v",target:"_blank",rel:"noopener noreferrer"}},[n("number",[n("OutboundLink")],1)],1),t._v(": 指定套接字超时的数值，以毫秒为单位。这会在套接字被连接之前设置超时。")])])]),t._v(" "),n("li",[n("code",[t._v("callback")]),t._v(" "),n("a",{attrs:{href:"http://nodejs.cn/s/ceTQa6",target:"_blank",rel:"noopener noreferrer"}},[n("Function",[n("OutboundLink")],1)],1),t._v(",可选的 "),n("code",[t._v("callback")]),t._v(" 参数会作为单次监听器被添加到 "),n("a",{attrs:{href:"http://nodejs.cn/s/qwaiK8",target:"_blank",rel:"noopener noreferrer"}},[n("code",[t._v("'response'")]),n("OutboundLink")],1),t._v(" 事件。")]),t._v(" "),n("li",[t._v("返回: "),n("a",{attrs:{href:"http://nodejs.cn/s/2F5RHd",target:"_blank",rel:"noopener noreferrer"}},[t._v("<http.ClientRequest>"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"_11-小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-小结"}},[t._v("#")]),t._v(" 11. 小结")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("导入http模块")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("创建服务并监听端口")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// res: http.ServerResponse类")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// req: http.ClientRequest类")]),t._v("\n    response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 优先于setHeader")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-type'")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/html;charset=UTF-8'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须调用end()方法")]),t._v("\n    res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),n("li",[n("p",[t._v("创建get请求")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://nodejs.cn/index.json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// do what you want")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("http.get")]),t._v("是创建http请求GET方法快捷方式。")])]),t._v(" "),n("li",[n("p",[t._v("创建post请求")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("method"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("code",[t._v("http.request")]),t._v("是创建http请求万能方法。")])])]),t._v(" "),n("blockquote",[n("p",[t._v("本文学习笔记大部分是查看官网API，部分是查看nodejs源码，只供参考，不喜勿喷 (#^.^#)。")])])])],1)],1)],1)}),[],!1,null,null,null);s.default=e.exports}}]);