<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【Node】NodeJS之操作MongoDB数据库</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.34d67128.css" as="style"><link rel="preload" href="/assets/js/app.874ad27f.js" as="script"><link rel="preload" href="/assets/js/2.b3303c0a.js" as="script"><link rel="preload" href="/assets/js/32.57c4f281.js" as="script"><link rel="prefetch" href="/assets/js/10.e2d5fd5d.js"><link rel="prefetch" href="/assets/js/11.918f4971.js"><link rel="prefetch" href="/assets/js/12.fe50ccb2.js"><link rel="prefetch" href="/assets/js/13.6705fd0d.js"><link rel="prefetch" href="/assets/js/14.d6571406.js"><link rel="prefetch" href="/assets/js/15.2005d985.js"><link rel="prefetch" href="/assets/js/16.a866f6ad.js"><link rel="prefetch" href="/assets/js/17.80643227.js"><link rel="prefetch" href="/assets/js/18.05491576.js"><link rel="prefetch" href="/assets/js/19.6decc808.js"><link rel="prefetch" href="/assets/js/20.9a690dd4.js"><link rel="prefetch" href="/assets/js/21.1c7c5b50.js"><link rel="prefetch" href="/assets/js/22.6f7a3b13.js"><link rel="prefetch" href="/assets/js/23.76e09167.js"><link rel="prefetch" href="/assets/js/24.1540b956.js"><link rel="prefetch" href="/assets/js/25.7081a3df.js"><link rel="prefetch" href="/assets/js/26.58abef39.js"><link rel="prefetch" href="/assets/js/27.a8099001.js"><link rel="prefetch" href="/assets/js/28.a7211e7c.js"><link rel="prefetch" href="/assets/js/29.fe630abe.js"><link rel="prefetch" href="/assets/js/3.ff88f47a.js"><link rel="prefetch" href="/assets/js/30.bf2a46b8.js"><link rel="prefetch" href="/assets/js/31.60b66d73.js"><link rel="prefetch" href="/assets/js/33.b37fe119.js"><link rel="prefetch" href="/assets/js/34.a5d2fe88.js"><link rel="prefetch" href="/assets/js/35.605d8c75.js"><link rel="prefetch" href="/assets/js/36.b066f4f0.js"><link rel="prefetch" href="/assets/js/37.a073290e.js"><link rel="prefetch" href="/assets/js/38.337e0dd3.js"><link rel="prefetch" href="/assets/js/39.cde4f245.js"><link rel="prefetch" href="/assets/js/4.22ace04f.js"><link rel="prefetch" href="/assets/js/40.de81fd73.js"><link rel="prefetch" href="/assets/js/41.a03d532b.js"><link rel="prefetch" href="/assets/js/42.53edd930.js"><link rel="prefetch" href="/assets/js/43.4e273487.js"><link rel="prefetch" href="/assets/js/44.263ea0d8.js"><link rel="prefetch" href="/assets/js/45.e412252e.js"><link rel="prefetch" href="/assets/js/46.c0b9fef1.js"><link rel="prefetch" href="/assets/js/47.d8539608.js"><link rel="prefetch" href="/assets/js/48.c8aad37f.js"><link rel="prefetch" href="/assets/js/49.23e5abe7.js"><link rel="prefetch" href="/assets/js/5.6fca250f.js"><link rel="prefetch" href="/assets/js/50.72eedbeb.js"><link rel="prefetch" href="/assets/js/51.eaf9a820.js"><link rel="prefetch" href="/assets/js/52.fce6a28f.js"><link rel="prefetch" href="/assets/js/53.bbb6ea02.js"><link rel="prefetch" href="/assets/js/54.f154c16c.js"><link rel="prefetch" href="/assets/js/55.51abd1ec.js"><link rel="prefetch" href="/assets/js/56.1a98e112.js"><link rel="prefetch" href="/assets/js/57.72a58790.js"><link rel="prefetch" href="/assets/js/58.57ca5a7c.js"><link rel="prefetch" href="/assets/js/59.6d0d6e28.js"><link rel="prefetch" href="/assets/js/6.5a263fb9.js"><link rel="prefetch" href="/assets/js/60.568a60c9.js"><link rel="prefetch" href="/assets/js/61.76cb0bef.js"><link rel="prefetch" href="/assets/js/62.ea947660.js"><link rel="prefetch" href="/assets/js/63.95fe4fda.js"><link rel="prefetch" href="/assets/js/64.4b749eb5.js"><link rel="prefetch" href="/assets/js/65.d0b70efc.js"><link rel="prefetch" href="/assets/js/66.03da0383.js"><link rel="prefetch" href="/assets/js/67.1d397d2f.js"><link rel="prefetch" href="/assets/js/68.beafaa77.js"><link rel="prefetch" href="/assets/js/69.96c64273.js"><link rel="prefetch" href="/assets/js/7.49b572ac.js"><link rel="prefetch" href="/assets/js/70.58a9ce18.js"><link rel="prefetch" href="/assets/js/71.24d0f737.js"><link rel="prefetch" href="/assets/js/72.7c9b99e4.js"><link rel="prefetch" href="/assets/js/73.638a8858.js"><link rel="prefetch" href="/assets/js/74.f0302eab.js"><link rel="prefetch" href="/assets/js/75.c9f9ec8f.js"><link rel="prefetch" href="/assets/js/76.e51ef0f7.js"><link rel="prefetch" href="/assets/js/77.3cc407f8.js"><link rel="prefetch" href="/assets/js/78.0a61f4b7.js"><link rel="prefetch" href="/assets/js/79.87520261.js"><link rel="prefetch" href="/assets/js/8.45778cc9.js"><link rel="prefetch" href="/assets/js/80.28e02b2c.js"><link rel="prefetch" href="/assets/js/81.8682c5b3.js"><link rel="prefetch" href="/assets/js/82.ae55b51f.js"><link rel="prefetch" href="/assets/js/83.7f388dc3.js"><link rel="prefetch" href="/assets/js/84.798f2927.js"><link rel="prefetch" href="/assets/js/9.2e6da626.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34d67128.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nodejs之操作mongodb数据库"><a href="#nodejs之操作mongodb数据库" class="header-anchor">#</a> NodeJS之操作MongoDB数据库</h1> <h2 id="_1-sql与nosql"><a href="#_1-sql与nosql" class="header-anchor">#</a> 1.SQL与NOSQL</h2> <p>SQL：Structure Query Language，结构性查询语言，使用SQL的数据库如：MySQL、SQLite、Oracle等(传统关系型数据库，使用行和列来存储数据，类似excel)。</p> <p>NOSQL：不使用SQL的数据库，如：MongoDB（以 JSON 或 XML 格式存储数据）、Redis、LevelDB等（非关系型分布式数据库）</p> <h3 id="_1-1-sql的acid"><a href="#_1-1-sql的acid" class="header-anchor">#</a> 1.1 SQL的ACID</h3> <p><strong>ACID — 数据库事务正确执行的四个基本要素</strong></p> <table><thead><tr><th></th> <th>名称</th> <th>说明</th></tr></thead> <tbody><tr><td><strong>A</strong></td> <td>原子性（Atomicity）</td> <td>一个事务中的所有操作，要么全部完成，要么全部不完成，不会在中间某个环节结束。事务在执行过程中发生错误，会被回滚到事务开始前的状态，就像这个事务从来没有执行过一样。</td></tr> <tr><td><strong>C</strong></td> <td>一致性（Consistency）</td> <td>在事务开始之前和事务结束以后，数据的数据的一致性约束没有被破坏。</td></tr> <tr><td><strong>I</strong></td> <td>隔离性（Isolation）</td> <td>数据库允许多个并发事务同时对数据进行读写和修改的能力。隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。。</td></tr> <tr><td><strong>D</strong></td> <td>持久性（Durability）</td> <td>事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</td></tr></tbody></table> <h3 id="_1-2-nosql（not-only-sql）的优缺点"><a href="#_1-2-nosql（not-only-sql）的优缺点" class="header-anchor">#</a> 1.2 NOSQL（Not Only SQL）的优缺点</h3> <p><strong>解决关系型数据库无法存储数据结构的问题</strong></p> <p>优点如下：</p> <ul><li><strong>高效的储存空间利用率</strong></li> <li><strong>查询效率高</strong></li> <li><strong>适合做聚合操作</strong></li> <li><strong>适合大量的数据而不是小数据</strong></li></ul> <p>缺点如下：</p> <ul><li>不适合扫描小量数据</li> <li>不适合随机的更新</li> <li>不适合做含有删除和更新的实时操作</li> <li>单行的数据是ACID的，多行的事务时，不支持事务的正常回滚，支持 I(Isolation)隔离性(事务串行提交)，D(Durability)持久性，不能保证 A(Atomicity)原子性， C(Consistency)一致性</li></ul> <h2 id="_2-mongodb使用"><a href="#_2-mongodb使用" class="header-anchor">#</a> 2. MongoDB使用</h2> <p>MongoDB 将数据存储为一个文档（Document）。MongoDB是一个基于分布式文件存储的数据库。</p> <p><a href="https://mongoing.com/archives/docs/mongodb%e4%b8%ad%e6%96%87%e7%94%a8%e6%88%b7%e6%89%8b%e5%86%8c%ef%bc%88version-4-2%ef%bc%89/mongodb%e5%ae%89%e8%a3%85/%e5%9c%a8windows%e4%b8%8a%e5%ae%89%e8%a3%85%e7%a4%be%e5%8c%ba%e7%89%88mongodb" target="_blank" rel="noopener noreferrer">安装MongoDB<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_2-0-连接"><a href="#_2-0-连接" class="header-anchor">#</a> 2.0 连接</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 开机</span>
<span class="token operator">&gt;</span> mongod --dbpath C:<span class="token punctuation">\</span>mongo
<span class="token comment"># 进入repl</span>
<span class="token operator">&gt;</span> mongo

<span class="token comment"># 显示数据库</span>
<span class="token operator">&gt;</span> show dbs
<span class="token comment"># 显示当前数据库</span>
<span class="token operator">&gt;</span> db
<span class="token comment"># 连接表</span>
<span class="token operator">&gt;</span> use <span class="token builtin class-name">test</span>
</code></pre></div><h3 id="_2-1-增insert"><a href="#_2-1-增insert" class="header-anchor">#</a> 2.1 增insert</h3> <p><code>db.COLLECTION_NAME.insert(document)</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 新建数据库（切换数据库）</span>
use <span class="token builtin class-name">test</span>
<span class="token comment"># 新建collection,并插入一document</span>
db.student.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>name: <span class="token string">'zkk'</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>name: <span class="token string">'zzz'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-2-删drop、remove"><a href="#_2-2-删drop、remove" class="header-anchor">#</a> 2.2 删drop、remove</h3> <p><code>db.collection.remove(&lt;query&gt;,&lt;justOne&gt;)</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 删除当前数据库</span>
db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除collection</span>
db.student.drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除一个document</span>
db.student.remove<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span> <span class="token string">'zkk'</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>justOne: true<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 删除所有documents</span>
db.db.student.remove<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-3-改update"><a href="#_2-3-改update" class="header-anchor">#</a> 2.3 改update</h3> <p><code>db.collection.update( criteria, objNew, upsert, multi )</code></p> <p>update()函数接受以下四个参数：</p> <ul><li><p><strong>criteria</strong> : update的查询条件，类似sql update查询内where后面的。</p></li> <li><p><strong>objNew</strong> : update的对象和一些更新的操作符（如$,$inc...）等，也可以理解为sql update查询内set后面的</p></li> <li><p><strong>upsert</strong> : 这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。</p></li> <li><p><strong>multi</strong> : mongodb默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 更改字段(默认一条，multi更新多条)</span>
db.student.update<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$gte</span><span class="token builtin class-name">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span><span class="token variable">$set</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">'desc'</span><span class="token builtin class-name">:</span> <span class="token string">'adult'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>, <span class="token punctuation">{</span>multi: true<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 拷贝数据库</span>
db.copyDatabase<span class="token punctuation">(</span><span class="token string">'oldTest'</span>, <span class="token string">'newTest'</span><span class="token punctuation">)</span>

<span class="token comment"># 1.改collection名</span>
db.student.renameCollection<span class="token punctuation">(</span><span class="token string">'teacher'</span><span class="token punctuation">)</span>
<span class="token comment"># 2.改collection名</span>
db.runCommand<span class="token punctuation">(</span><span class="token punctuation">{</span>renameCollection: <span class="token string">'test.student'</span>, to: <span class="token string">'test.teacher'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-4-查find"><a href="#_2-4-查find" class="header-anchor">#</a> 2.4 查find</h3> <h4 id="_2-4-1-一般查询find"><a href="#_2-4-1-一般查询find" class="header-anchor">#</a> 2.4.1 一般查询find</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 查看所有库</span>
show dbs

<span class="token comment"># 查看当前库下的所有表</span>
show collections

<span class="token comment"># 查当前表字段,并格式化</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.petty<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查看一条</span>
db.student.findOne<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-4-2条件查询-gt"><a href="#_2-4-2条件查询-gt" class="header-anchor">#</a> 2.4.2条件查询 $gt</h4> <p>MongoDB中条件操作符有：</p> <ul><li>(&gt;) 大于 - $gt</li> <li>(&lt;) 小于 - $lt</li> <li>(&gt;=) 大于等于 - $gte</li> <li>(&lt;= ) 小于等于 - $lte</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 条件查询</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span><span class="token string">'zkk'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># or查询</span>
db.student.find<span class="token punctuation">(</span><span class="token variable">$or</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span><span class="token string">'zkk'</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span><span class="token string">'zzz'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 大于$gt 小于$lt 大于等于$gte 小于等于$lte</span>
<span class="token comment"># &gt; 18</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$gt</span><span class="token builtin class-name">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token comment"># &lt; 18</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$lt</span><span class="token builtin class-name">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token comment"># &gt;=18</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$gte</span><span class="token builtin class-name">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token comment"># [18, 36]</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'age'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$gte</span><span class="token builtin class-name">:</span> <span class="token number">18</span>, <span class="token variable">$lte</span><span class="token builtin class-name">:</span> <span class="token number">36</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 
</code></pre></div><h4 id="_2-4-3-分页查询limit、skip"><a href="#_2-4-3-分页查询limit、skip" class="header-anchor">#</a> 2.4.3 分页查询limit、skip</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 查前n条</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>n<span class="token punctuation">)</span>

<span class="token comment"># 查从第m+1后开始的n条 --- 分页查询</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span>n<span class="token punctuation">)</span>.skip<span class="token punctuation">(</span>m<span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-4-4-排序查询sort"><a href="#_2-4-4-排序查询sort" class="header-anchor">#</a> 2.4.4 排序查询sort</h4> <p><code>db.COLLECTION_NAME.find().sort({KEY:1})</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 按key升序查询 1   降序 -1</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>age: <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-4-5-正则查询-regex"><a href="#_2-4-5-正则查询-regex" class="header-anchor">#</a> 2.4.5 正则查询$regex</h4> <p>option的值包含：</p> <ul><li>i(不区分大小写)，</li> <li>m(当使用^与$符号模糊匹配时，作用于屏蔽中间的换行符) ,</li> <li>x(忽略注释，以#开头 /n结尾)，</li> <li>s(允许所有字符包括换行符参与模糊匹配)</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token variable">$regex</span><span class="token builtin class-name">:</span> <span class="token string">'/[a-z]/'</span>, <span class="token variable">$options</span><span class="token builtin class-name">:</span> <span class="token string">'<span class="token variable">$i</span>'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="_2-4-6-聚合查询aggregate"><a href="#_2-4-6-聚合查询aggregate" class="header-anchor">#</a> 2.4.6 聚合查询aggregate</h4> <p><code>db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)</code></p> <p>集合中的数据如下：</p> <div class="language- extra-class"><pre class="language-text"><code>{
   _id: ObjectId(7df78ad8902c)
   title: 'MongoDB Overview', 
   description: 'MongoDB is no sql database',
   by_user: 'w3cschool.cn',
   url: 'http://www.w3cschool.cn',
   tags: ['mongodb', 'database', 'NoSQL'],
   likes: 100
},
{
   _id: ObjectId(7df78ad8902d)
   title: 'NoSQL Overview', 
   description: 'No sql database is very fast',
   by_user: 'w3cschool.cn',
   url: 'http://www.w3cschool.cn',
   tags: ['mongodb', 'database', 'NoSQL'],
   likes: 10
},
{
   _id: ObjectId(7df78ad8902e)
   title: 'Neo4j Overview', 
   description: 'Neo4j is no sql database',
   by_user: 'Neo4j',
   url: 'http://www.neo4j.com',
   tags: ['neo4j', 'database', 'NoSQL'],
   likes: 750
},
</code></pre></div><p>现在我们通过以上集合计算每个作者所写的文章数，使用aggregate()计算结果如下：</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : 1}}}])
{
   &quot;result&quot; : [
      {
         &quot;_id&quot; : &quot;w3cschool.cn&quot;,
         &quot;num_tutorial&quot; : 2
      },
      {
         &quot;_id&quot; : &quot;Neo4j&quot;,
         &quot;num_tutorial&quot; : 1
      }
   ],
   &quot;ok&quot; : 1
}
&gt;
</code></pre></div><p>以上实例类似sql语句： <em>select by_user, count(*) from mycol group by by_user</em></p> <p>在上面的例子中，我们通过字段by_user字段对数据进行分组，并计算by_user字段相同值的总和。</p> <p>下表展示了一些聚合的表达式:</p> <table><thead><tr><th style="text-align:left;">表达式</th> <th style="text-align:left;">描述</th> <th style="text-align:left;">实例</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>$sum</code></td> <td style="text-align:left;">计算总和。</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$sum : &quot;$likes&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$avg</code></td> <td style="text-align:left;">计算平均值</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$avg : &quot;$likes&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$min</code></td> <td style="text-align:left;">获取集合中所有文档对应值得最小值。</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$min : &quot;$likes&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$max</code></td> <td style="text-align:left;">获取集合中所有文档对应值得最大值。</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, num_tutorial : {$max : &quot;$likes&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$push</code></td> <td style="text-align:left;">在结果文档中插入值到一个数组中。</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$push: &quot;$url&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$addToSet</code></td> <td style="text-align:left;">在结果文档中插入值到一个数组中，但不创建副本。</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, url : {$addToSet : &quot;$url&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$first</code></td> <td style="text-align:left;">根据资源文档的排序获取第一个文档数据。</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, first_url : {$first : &quot;$url&quot;}}}])</code></td></tr> <tr><td style="text-align:left;"><code>$last</code></td> <td style="text-align:left;">根据资源文档的排序获取最后一个文档数据</td> <td style="text-align:left;"><code>db.mycol.aggregate([{$group : {_id : &quot;$by_user&quot;, last_url : {$last : &quot;$url&quot;}}}])</code></td></tr></tbody></table> <h3 id="_2-5-建立索引"><a href="#_2-5-建立索引" class="header-anchor">#</a> 2.5 建立索引</h3> <p>建立索引之后可以增快检索速度。</p> <ul><li>查看检索的详情</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 查看检索的详情步骤</span>
db.student.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span><span class="token string">'zkk'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.explain<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>创建一个单键索引：在某个集合上只查询某个单键</p> <p><code>db.student.createIndex({key: 1}, {unique: true});</code>：1-正向索引 -1-负向索引。<code>unique</code>设为true，表示唯一索引，不能重复。</p></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>db.student.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  

<span class="token comment"># 输出</span>
<span class="token punctuation">{</span>
    <span class="token string">'createdCollectionAutomatically'</span><span class="token builtin class-name">:</span> false,
    <span class="token string">'numIndexesBefore'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
    <span class="token string">'numIndexesAfter'</span><span class="token builtin class-name">:</span> <span class="token number">2</span>,
    <span class="token string">'OK'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>创建复合索引：需要查询某个键，而有时又需要查询同样的键和额外的键</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>db.products.createIndex<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token string">&quot;category&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;item&quot;</span><span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span>
</code></pre></div><blockquote><p><a href="https://mongoing.com/docs/reference/indexes.html" target="_blank" rel="noopener noreferrer">索引参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="_3-nodejs操作mongodb"><a href="#_3-nodejs操作mongodb" class="header-anchor">#</a> 3. NodeJS操作MongoDB</h2> <blockquote><p><a href="http://mongodb.github.io/node-mongodb-native/3.6/" target="_blank" rel="noopener noreferrer">MongoDB Node.js Driver Documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h3 id="_3-1-安装"><a href="#_3-1-安装" class="header-anchor">#</a> 3.1 安装</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> mongodb --save
</code></pre></div><h3 id="_3-2-连接数据库"><a href="#_3-2-连接数据库" class="header-anchor">#</a> 3.2 连接数据库</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient<span class="token punctuation">;</span>
<span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Connection URL</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'mongodb://localhost:27017'</span><span class="token punctuation">;</span>

<span class="token comment">// Database Name</span>
<span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">'myproject'</span><span class="token punctuation">;</span>

<span class="token comment">// Create a new MongoClient</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use connect method to connect to the Server</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected successfully to server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>

  client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-3-curd操作"><a href="#_3-3-curd操作" class="header-anchor">#</a> 3.3 CURD操作</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>MongoClient<span class="token punctuation">;</span>
<span class="token keyword">const</span> assert <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Connection URL</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'mongodb://localhost:27017'</span><span class="token punctuation">;</span>

<span class="token comment">// Database Name</span>
<span class="token keyword">const</span> dbName <span class="token operator">=</span> <span class="token string">'myproject'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use connect method to connect to the server</span>
client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connected successfully to server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">insertDocuments</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">findDocuments</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">updateDocument</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">removeDocument</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// insert方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">insertDocuments</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the documents collection</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Insert some documents</span>
  collection<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>a <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>result<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Inserted 3 documents into the collection&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// find方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">findDocuments</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the documents collection</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Find some documents</span>
  collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> docs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Found the following records&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// update方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">updateDocument</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the documents collection</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Update document where a is 2, set b equal to 1</span>
  collection<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a <span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
    <span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> b <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>result<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Updated the document with the field a equal to 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token comment">// remove方法</span>
<span class="token keyword">const</span> <span class="token function-variable function">removeDocument</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the documents collection</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Delete document where a is 3</span>
  collection<span class="token punctuation">.</span><span class="token function">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a <span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>result<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Removed the document with the field a equal to 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_4-使用mogoose框架"><a href="#_4-使用mogoose框架" class="header-anchor">#</a> 4.使用Mogoose框架</h2> <p>Mogoose是一个将Javascript对象与数据库产生关系的一个框架，ORM（object relation model）。使得操作对象，就是操作数据库了，对象产生了，同时也持久化了。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 连接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定义Schema</span>
<span class="token keyword">const</span> catSchema <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个模型，有属性 name</span>
<span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> catSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 实例化Cat</span>
<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Zildjian'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 调用save之后就会保存进数据库中</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'meow'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面的代码，没有一句是明显的数据库操作，体验全是操作类（创建类、实例化类、调用类的方法），但是数据库持久了。<strong>mongoose的设计哲学：操作对象的形式来操作数据库</strong></p> <ul><li><code>Schema.methods</code>对象直接保存实例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 实例方法</span>
<span class="token comment">// 在catSchema的methods对象上分配实例方法</span>
catSchema<span class="token punctuation">.</span>methods<span class="token punctuation">.</span><span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Schema.statics</code>对象直接保存静态方法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建静态方法</span>
<span class="token comment">// 在catSchema的statics对象上分配一个静态方法</span>
catSchema<span class="token punctuation">.</span>statics<span class="token punctuation">.</span><span class="token function-variable function">haha</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><iframe src="https://mongoose.kkfor.com/guides.html" height="600px"><h2 id="_5-参考文档"><a href="#_5-参考文档" class="header-anchor">#</a> 5. 参考文档</h2> <ul><li><a href="https://juejin.im/post/5b6d62ddf265da0f491bd200#heading-2" target="_blank" rel="noopener noreferrer">NoSQL 还是 SQL ？这一篇讲清楚<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/post/5a9ca0d6518825555c1d1acd" target="_blank" rel="noopener noreferrer">数据库常见面试题(开发者篇)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mongoing.com/archives/docs/mongodb%e4%b8%ad%e6%96%87%e7%94%a8%e6%88%b7%e6%89%8b%e5%86%8c%ef%bc%88version-4-2%ef%bc%89/mongodb%e5%ae%89%e8%a3%85/%e5%9c%a8windows%e4%b8%8a%e5%ae%89%e8%a3%85%e7%a4%be%e5%8c%ba%e7%89%88mongodb" target="_blank" rel="noopener noreferrer">MongoDB中文用户手册（Version 4.2）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mongoose.kkfor.com/quickstart.html" target="_blank" rel="noopener noreferrer">mongoose5.2.8中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mongoosejs.com/" target="_blank" rel="noopener noreferrer">mongoosejs英文官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></iframe></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.874ad27f.js" defer></script><script src="/assets/js/2.b3303c0a.js" defer></script><script src="/assets/js/32.57c4f281.js" defer></script>
  </body>
</html>
